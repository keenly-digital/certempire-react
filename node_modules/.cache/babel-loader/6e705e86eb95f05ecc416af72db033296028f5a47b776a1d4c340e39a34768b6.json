{"ast":null,"code":"// src/pages/SimulationPage.tsx\nimport React,{useState,useEffect}from'react';import styled from'styled-components';import{useParams,useLocation}from'react-router-dom';import{supabase}from'../supabaseClient';import HtmlRenderer from'../components/utils/HtmlRenderer';// 1. Import the new component\nimport{useDebounce}from'use-debounce';import{useUser}from'../context/UserContext';// HELPERS\n// --- Helper function ---\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const formatParagraphs=text=>{if(!text||typeof text!=='string'){return\"\";}// Regex to find URLs (http, https, or www domains)\nconst urlRegex=/(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;return text.split('\\n').filter(line=>line.trim()!=='').map(line=>{// Find and replace URLs within the line with <a> tags\nconst lineWithLinks=line.replace(urlRegex,url=>{// Prepend 'http://' to www links for them to work correctly\nconst href=url.startsWith('www.')?`http://${url}`:url;// Return the HTML link tag\nreturn`<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${url}</a>`;});// Wrap the entire processed line in a <p> tag\nreturn`<p>${lineWithLinks}</p>`;}).join('');};// --- Type Definitions ---\n// --- SVG Icons ---\nconst IconSearch=()=>/*#__PURE__*/_jsx(\"svg\",{width:\"20\",height:\"20\",viewBox:\"0 0 15 15\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159L11.5 12.5L12.5 11.5L10.0158 9.30885C9.42248 9.75587 8.68594 10.0345 7.89932 10.0883L6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5C10 7.50556 9.61334 8.42373 9.00001 9.13098L9.30884 10.0159Z\",fill:\"#757575\"})});const IconDownload=()=>/*#__PURE__*/_jsx(\"svg\",{width:\"18\",height:\"18\",viewBox:\"0 0 15 15\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M4 6H2V12.5C2 12.7761 2.22386 13 2.5 13H12.5C12.7761 13 13 12.7761 13 12.5V6H11V12H4V6ZM7.5 10L11 5H8V2H7V5H4L7.5 10Z\",fill:\"currentColor\"})});const IconEye=()=>/*#__PURE__*/_jsx(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 15 15\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M7.5 11C4.79322 11 2.49241 9.2993 1.05532 7.50001C2.49241 5.70072 4.79322 4 7.5 4C10.2068 4 12.5076 5.70072 13.9447 7.50001C12.5076 9.2993 10.2068 11 7.5 11ZM7.5 3C4.33776 3 1.68988 5.00373 0.160645 6.88398L0.116041 6.94165C-0.0386803 7.14378 -0.0386803 7.85624 0.116041 8.05837L0.160645 8.11604C1.68988 9.99629 4.33776 12 7.5 12C10.6622 12 13.3101 9.99629 14.8394 8.11604L14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398C13.3101 5.00373 10.6622 3 7.5 3ZM7.5 9C6.40237 9 5.50655 8.11289 5.5 7.00001C5.50655 5.88713 6.40237 5.00001 7.5 5.00001C8.59763 5.00001 9.49345 5.88713 9.5 7.00001C9.49345 8.11289 8.59763 9 7.5 9Z\",fill:\"currentColor\"})});const IconEyeSlash=()=>/*#__PURE__*/_jsx(\"svg\",{width:\"16\",height:\"16\",viewBox:\"0 0 15 15\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M1.3415 13.6585L13.6582 1.34176L12.9511 0.634691L0.634433 12.9514L1.3415 13.6585ZM4.39893 9.60107C3.13626 8.87784 2.15372 7.84628 1.05532 7.5C2.49241 5.70072 4.79322 4 7.5 4C8.61439 4 9.66427 4.29891 10.584 4.80878L9.49989 6.00001C9.49561 5.92548 9.24345 5.88713 9.5 7C9.49345 8.11289 8.59763 9 7.5 9C6.81406 9 6.20237 8.68594 5.86902 8.13098L4.39893 9.60107ZM14.8394 6.88398C13.5936 5.25338 11.6622 3 7.5 3C6.59763 3 5.75655 3.20237 5.00001 3.55837L6.50001 5C6.40237 5 5.50655 5.88713 5.5 7C5.50655 7.24345 5.57452 7.46548 5.68988 7.68988L7.584 9.584C8.75655 9.42548 9.49345 8.49345 9.5 7.41594L13.8839 12.8394C14.4934 12.1129 14.8394 11.2434 14.8394 10.5C14.8394 9.99629 13.3101 8.11604 14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398Z\",fill:\"currentColor\"})});const IconTopicFolder=_ref=>{let{style={}}=_ref;return/*#__PURE__*/_jsx(\"svg\",{style:style,width:\"28\",height:\"28\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M3 5C3 4.44772 3.44772 4 4 4H9.17157C9.58052 4 9.91096 4.24065 10.0607 4.58579L10.5858 5.75736C10.7355 6.1025 11.0659 6.34315 11.4749 6.34315H20C20.5523 6.34315 21 6.79086 21 7.34315V18C21 18.5523 20.5523 19 20 19H4C3.44772 19 3 18.5523 3 18V5Z\",fill:\"#000000\",fillOpacity:\"0.7\"})});};const IconCaseStudy=()=>/*#__PURE__*/_jsx(\"svg\",{width:\"24\",height:\"24\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M4 4H20V20H4V4ZM3 3V21H21V3H3ZM6 6H18V8H6V6ZM6 10H18V12H6V10ZM6 14H14V16H6V14Z\",fill:\"#673AB7\"})});const IconArrowBack=_ref2=>{let{style={}}=_ref2;return/*#__PURE__*/_jsx(\"svg\",{style:style,width:\"20\",height:\"20\",viewBox:\"0 0 15 15\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M6.85355 3.14645C7.04882 3.34171 7.04882 3.65829 6.85355 3.85355L3.70711 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H3.70711L6.85355 11.1464C7.04882 11.3417 7.04882 11.6583 6.85355 11.8536C6.65829 12.0488 6.34171 12.0488 6.14645 11.8536L1.64645 7.35355C1.45118 7.15829 1.45118 6.84171 1.64645 6.64645L6.14645 2.14645C6.34171 1.95118 6.65829 1.95118 6.85355 2.14645Z\",fill:\"currentColor\"})});};const IconArrowForward=_ref3=>{let{style={}}=_ref3;return/*#__PURE__*/_jsx(\"svg\",{style:style,width:\"20\",height:\"20\",viewBox:\"0 0 15 15\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M8.14645 3.14645C8.34171 3.34171 8.34171 3.65829 8.14645 3.85355L4.99999 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H5L8.14645 11.1464C8.34171 11.3417 8.34171 11.6583 8.14645 11.8536C7.95118 12.0488 7.6346 12.0488 7.43934 11.8536L2.93934 7.35355C2.74408 7.15829 2.74408 6.84171 2.93934 6.64645L7.43934 2.14645C7.6346 1.95118 7.95118 1.95118 8.14645 2.14645Z\",fill:\"currentColor\",transform:\"scale(-1,1) translate(-15,0)\"})});};// --- Helper function ---\nconst flattenItems=topics=>{const flatList=[];Object.entries(topics).forEach(_ref4=>{let[topicKey,topic]=_ref4;if(topic.topic_name){flatList.push({type:'topic',content:{title:topic.topic_name,caseStudyCount:topic.case_study?1:0}});}if(topic.case_study){var _topic$questions;flatList.push({type:'case_study',content:{title:topic.topic_name||topicKey,description:topic.case_study,questionsCount:((_topic$questions=topic.questions)===null||_topic$questions===void 0?void 0:_topic$questions.length)||0}});}(topic.questions||[]).forEach((q,qIndex)=>{flatList.push({type:'question',content:{...q,question_number:q.question_number||(qIndex+1).toString()}});});});return flatList;};// --- Styled Components (Full Definitions) ---\nconst PageContainer=styled.div` display: flex; flex-direction: column; gap: 16px; `;const HeaderContainer=styled.div`\n  @media (min-width: 651px) { display: flex; flex-direction: row; align-items: center; justify-content: space-between; gap: 16px; }\n  @media (max-width: 650px) { display: flex; flex-direction: column; gap: 16px; }\n`;const FileName=styled.h2` color: #2c2c54; font-weight: bold; font-size: 22px; `;const HeaderActions=styled.div` display: flex; align-items: center; gap: 12px; `;const DownloadButtonText=styled.span`\n  display: inline;\n  @media (max-width: 650px) {\n    display: none;\n  }\n`;const ViewToggle=styled.div`\n  display: flex; align-items: center; gap: 4px; padding: 4px 8px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px;\n  span { font-weight: bold; color: #757575; }\n  svg { color: #757575; }\n`;const Switch=styled.input.attrs({type:'checkbox'})`\n  appearance: none; width: 34px; height: 20px; background: #E0E0E0; border-radius: 10px; position: relative; cursor: pointer;\n  &:checked { background: #673AB7; }\n  &::before { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: 0.2s; }\n  &:checked::before { left: 16px; }\n`;const GoToButton=styled.button`\n  background: none; border: 1px solid #E0E0E0; padding: 8px 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; color: #757575;\n`;const DownloadButton=styled.button`\n  background-color: #673AB7; color: white; border: none; border-radius: 12px; padding: 10px 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px;\n  @media (max-width: 650px) { padding: 12px; border-radius: 50%; }\n`;const GoToFieldContainer=styled.div`\n  height: ${_ref5=>{let{$show}=_ref5;return $show?'60px':'0';}}; display: flex; justify-content: center; align-items: center; gap: 8px; overflow: hidden; transition: height 0.3s;\n`;const GoToInput=styled.input` width: 150px; text-align: center; border: 1px solid #E0E0E0; border-radius: 8px; padding: 8px; `;const GoButton=styled.button` background-color: #673AB7; color: white; border: none; padding: 8px 16px; border-radius: 8px; `;const ContentContainer=styled.div` background-color: white; border-radius: 12px; border: 1px solid #E0E0E0; `;const TopicHeader=styled.div` padding: 24px 16px 16px; display: flex; align-items: center; gap: 16px; font-size: 20px; font-weight: bold; color: #424242; span { font-weight: 500; } `;const CaseStudyContainer=styled.div` background-color: rgba(239, 234, 254, 0.4); border-bottom: 1px solid rgba(103, 58, 183, 0.2); padding: 26px; `;const CaseStudyHeader=styled.div` display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: bold; color: #673AB7; @media (max-width: 500px) { flex-direction: column; align-items: flex-start; } `;const CaseStudyLabel=styled.p` color: #BDBDBD; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; `;const CaseStudyQuestions=styled.span` font-size: 14px; font-weight: 500; color: #757575; `;const CaseStudyToggle=styled.button` background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;const CaseStudyContent=styled.div`\n  max-height: ${_ref6=>{let{$expanded}=_ref6;return $expanded?'none':'50px';}}; overflow: hidden; transition: max-height 0.3s; \n`;const HideButtonBottom=styled.button` position: absolute; bottom: 10px; right: 10px; background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;const QuestionCardContainer=styled.div` padding: 26px; `;const QuestionHeader=styled.div` @media (min-width: 601px) { display: flex; align-items: flex-start; gap: 18px; } @media (max-width: 600px) { display: flex; flex-direction: column; gap: 16px; } `;const QuestionNumber=styled.div` background-color: rgba(103, 58, 183, 0.12); color: #673AB7; font-weight: bold; font-size: 16px; padding: 12px; border-radius: 10px; `;const Label=styled.p` color:rgb(131, 129, 131); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; margin-top: 20px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `;const OptionsList=styled.div` display: flex; flex-direction: column; gap: 11px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `;// This is the only change you need\nconst OptionItem=styled.div`\n  display: flex;\n align-items: baseline;\n  gap: 8px;\n  border: 1px solid ${_ref7=>{let{$isCorrect}=_ref7;return $isCorrect?'#38b000':'#E0E0E0';}};\n  background: ${_ref8=>{let{$isCorrect}=_ref8;return $isCorrect?'#F4FBF6':'transparent';}};\n  border-radius: 8px;\n  padding: 11px 14px;\n  font-size: 15px;\n  line-height: 1.35;\n  transition: all 0.14s;\n  box-shadow: ${_ref9=>{let{$isCorrect}=_ref9;return $isCorrect?'0 2px 6px rgba(56,176,0,0.1)':'none';}};\n`;const ActionButtons=styled.div` display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 8px; margin-top: 26px; `;const PrimaryButton=styled.button` border: none; background-color: #673AB7; color: white; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; `;const CorrectAnswerSection=styled.div` display: flex; align-items: center; gap: 8px; padding: 12px 0; @media (max-width: 600px) { flex-direction: column; align-items: flex-start; gap: 16px; } `;const CorrectLabel=styled.span`\n  display: block; /* ✅ Stacks the elements vertically */\n  color:rgb(0, 0, 0);\n  font-weight: 600;\n  font-size: 13px;\n  margin-bottom: 5px;\n`;const CorrectText=styled.span`\n  font-weight: regular;\n  font-size: 15px;\n`;const ExplanationSection=styled.div` margin-top: 8px; `;const PaginationContainer=styled.div` display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px; `;const PageButton=styled.button` background: none; border: 1px solid #E0E0E0; color: #333; padding: 8px 16px; border-radius: 8px; cursor: pointer; &:disabled { cursor: not-allowed; opacity: 0.5; } `;const LoadingContainer=styled.div` display: flex; justify-content: center; align-items: center; height: 300px; font-size: 18px; color: #757575;`;const PaginationText=styled.span` color: #757575; font-weight: 500; `;// --- The Main Page Component ---\n// STATE HOOKS\nconst SimulationPage=()=>{var _location$state,_currentItem$parent,_currentItem$parent2,_currentItem$parent3,_currentItem$parent$c;const{fileId}=useParams();const[simulationData,setSimulationData]=useState(null);const[structuredItems,setStructuredItems]=useState([]);const[currentIndex,setCurrentIndex]=useState(0);const[isLoading,setLoading]=useState(true);const[showAnswer,setShowAnswer]=useState(false);const[isSingleView,setIsSingleView]=useState(true);const[showGoToField,setShowGoToField]=useState(false);const[goToInput,setGoToInput]=useState('');const[showAnswersMap,setShowAnswersMap]=useState({});const{user}=useUser();const location=useLocation();const[multiViewPage,setMultiViewPage]=useState(1);const startIndex=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.startIndex;const[debouncedIndex]=useDebounce(currentIndex,1500);// Saves 1.5s after user stops\nconst[alertInfo,setAlertInfo]=useState({isOpen:false,message:\"\",href:null});const handleReferenceLinkClick=href=>{setAlertInfo({isOpen:true,href:href,// Store the link to open\nmessage:\"You are accessing a reference link. Before you move out, please remember that platforms keep changing their URLs for such documents, and by the time you click it, it might have changed. In case the link is broken or returns a \\\"Not Found,\\\" error, the best way is to search the reference doc online. Thank you.\"});};const handleAlertConfirm=()=>{// This function runs when \"OK\" is clicked.\nif(alertInfo.href){// This method is more likely to open a new tab instead of a new window.\nconst link=document.createElement('a');link.href=alertInfo.href;link.target='_blank';link.rel='noopener noreferrer';link.click();}// Close the modal\nsetAlertInfo({isOpen:false,message:\"\",href:null});};useEffect(()=>{if(!fileId)return;async function getSimulationData(){var _data$aiParsedData,_data$aiParsedData$re;setLoading(true);const{data,error}=await supabase.from('files').select('filename, ai-parsed-data').eq('id',fileId).single();if(error){console.error(\"Error fetching file:\",error);}else if(data&&(_data$aiParsedData=data['ai-parsed-data'])!==null&&_data$aiParsedData!==void 0&&(_data$aiParsedData$re=_data$aiParsedData.result)!==null&&_data$aiParsedData$re!==void 0&&_data$aiParsedData$re.topics){const topics=data['ai-parsed-data'].result.topics;setSimulationData({fileName:data.filename,topics:topics});const newStructuredItems=[];let globalQNum=1;Object.values(topics).forEach(topic=>{(topic.questions||[]).forEach(q=>{var _topic$questions2;newStructuredItems.push({type:'question',content:{...q,question_number:(globalQNum++).toString()},parent:{topic:topic.topic_name,caseStudyTitle:topic.case_study?topic.topic_name:undefined,caseStudyDescription:topic.case_study?topic.case_study:undefined,caseStudyQuestionsCount:topic.case_study?((_topic$questions2=topic.questions)===null||_topic$questions2===void 0?void 0:_topic$questions2.length)||0:0}});});});setStructuredItems(newStructuredItems);if(startIndex&&startIndex>0&&startIndex<newStructuredItems.length){setCurrentIndex(startIndex);}}setLoading(false);}getSimulationData();},[fileId]);useEffect(()=>{setShowAnswer(false);},[currentIndex]);// --- This entire block is new ---\nuseEffect(()=>{const saveProgress=async()=>{// Use the user object directly from your context\nif(!user||!fileId||!simulationData||structuredItems.length===0){return;}const{error}=await supabase.from('user_progress').upsert({// This now sends the correct numeric WordPress ID\nuser_id:user.id,last_viewed_file_id:fileId,product_name:simulationData.fileName,last_viewed_question_index:debouncedIndex,total_questions:structuredItems.length,updated_at:new Date().toISOString()});if(error){console.error(\"Supabase error saving progress:\",error);}};// Only save if the user has actually navigated to a question\nsaveProgress();},[debouncedIndex,user,fileId,simulationData,structuredItems.length]);// Dependencies\nuseEffect(()=>{setCurrentIndex(0);setShowAnswersMap({});setShowAnswer(false);setMultiViewPage(1);},[isSingleView]);const handleNext=()=>setCurrentIndex(prev=>Math.min(prev+1,structuredItems.length-1));const handlePrev=()=>setCurrentIndex(prev=>Math.max(prev-1,0));const currentItem=structuredItems[currentIndex];if(isLoading)return/*#__PURE__*/_jsx(LoadingContainer,{children:\"Loading Simulation...\"});if(!currentItem)return/*#__PURE__*/_jsx(LoadingContainer,{children:\"Could not load questions for this file.\"});// ✅ CALCULATE PAGINATION FOR MULTI-VIEW\nconst itemsPerPage=25;const allMultiViewItems=flattenItems((simulationData===null||simulationData===void 0?void 0:simulationData.topics)||{});const totalMultiViewPages=Math.ceil(allMultiViewItems.length/itemsPerPage);// Get the 25 items for the current page\nconst paginatedMultiViewItems=allMultiViewItems.slice((multiViewPage-1)*itemsPerPage,multiViewPage*itemsPerPage);return/*#__PURE__*/_jsxs(PageContainer,{children:[/*#__PURE__*/_jsxs(HeaderContainer,{children:[/*#__PURE__*/_jsx(FileName,{title:simulationData===null||simulationData===void 0?void 0:simulationData.fileName,children:simulationData===null||simulationData===void 0?void 0:simulationData.fileName}),/*#__PURE__*/_jsxs(HeaderActions,{children:[/*#__PURE__*/_jsxs(ViewToggle,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"View:\"}),/*#__PURE__*/_jsx(IconTopicFolder,{style:{color:!isSingleView?'#673AB7':'#757575',width:20,height:20}}),/*#__PURE__*/_jsx(Switch,{checked:isSingleView,onChange:e=>setIsSingleView(e.target.checked)}),/*#__PURE__*/_jsx(\"svg\",{width:\"20\",height:\"20\",viewBox:\"0 0 24 24\",fill:\"none\",xmlns:\"http://www.w3.org/2000/svg\",style:{color:isSingleView?'#673AB7':'#757575'},children:/*#__PURE__*/_jsx(\"path\",{d:\"M4 6H20V8H4V6ZM4 11H20V13H4V11ZM4 16H20V18H4V16Z\",fill:\"currentColor\"})})]}),/*#__PURE__*/_jsxs(GoToButton,{onClick:()=>setShowGoToField(!showGoToField),children:[/*#__PURE__*/_jsx(IconSearch,{}),\" Go To\"]}),/*#__PURE__*/_jsxs(DownloadButton,{onClick:()=>{/* ... */},children:[/*#__PURE__*/_jsx(IconDownload,{}),/*#__PURE__*/_jsx(DownloadButtonText,{children:\"Download\"})]})]})]}),/*#__PURE__*/_jsxs(GoToFieldContainer,{$show:showGoToField,children:[/*#__PURE__*/_jsx(GoToInput,{type:\"number\",value:goToInput,onChange:e=>setGoToInput(e.target.value),placeholder:\"Go to...\"}),/*#__PURE__*/_jsx(GoButton,{onClick:()=>{const target=parseInt(goToInput);if(target>=1&&target<=structuredItems.length){setCurrentIndex(target-1);setIsSingleView(true);setShowGoToField(false);setGoToInput('');}else{alert(`Enter a number between 1 and ${structuredItems.length}`);}},children:\"Go\"})]}),/*#__PURE__*/_jsx(ContentContainer,{children:isSingleView?/*#__PURE__*/// --- Single View (no changes here) ---\n_jsxs(_Fragment,{children:[((_currentItem$parent=currentItem.parent)===null||_currentItem$parent===void 0?void 0:_currentItem$parent.topic)&&/*#__PURE__*/_jsxs(TopicHeader,{children:[/*#__PURE__*/_jsx(IconTopicFolder,{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"Topic: \"}),currentItem.parent.topic,((_currentItem$parent2=currentItem.parent)===null||_currentItem$parent2===void 0?void 0:_currentItem$parent2.caseStudyDescription)&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:14,color:'#757575'},children:\"Case Studies: 1\"})]})]}),((_currentItem$parent3=currentItem.parent)===null||_currentItem$parent3===void 0?void 0:_currentItem$parent3.caseStudyTitle)&&/*#__PURE__*/_jsx(RenderCaseStudy,{caseStudy:{title:currentItem.parent.caseStudyTitle||'Case Study',description:currentItem.parent.caseStudyDescription||'',questionsCount:(_currentItem$parent$c=currentItem.parent.caseStudyQuestionsCount)!==null&&_currentItem$parent$c!==void 0?_currentItem$parent$c:0}}),/*#__PURE__*/_jsx(RenderQuestion,{question:currentItem.content,showAnswer:showAnswer,setShowAnswer:setShowAnswer,onLinkClick:handleReferenceLinkClick})]}):/*#__PURE__*/// --- ✅ MODIFIED MULTI-VIEW WITH PAGINATION ---\n_jsxs(_Fragment,{children:[paginatedMultiViewItems.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{children:[item.type==='topic'&&/*#__PURE__*/_jsxs(TopicHeader,{children:[/*#__PURE__*/_jsx(IconTopicFolder,{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"Topic: \"}),item.content.title,item.content.caseStudyCount>0&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:14,color:'#757575'},children:[\"Case Studies: \",item.content.caseStudyCount]})]})]}),item.type==='case_study'&&/*#__PURE__*/_jsx(RenderCaseStudy,{caseStudy:item.content}),item.type==='question'&&/*#__PURE__*/_jsx(RenderQuestion,{question:item.content,showAnswer:showAnswersMap[item.content.question_number]||false,setShowAnswer:newVal=>setShowAnswersMap(prev=>({...prev,[item.content.question_number]:newVal})),onLinkClick:handleReferenceLinkClick})]},index)),totalMultiViewPages>1&&/*#__PURE__*/_jsxs(PaginationContainer,{children:[/*#__PURE__*/_jsxs(PaginationText,{children:[\"Page \",multiViewPage,\" of \",totalMultiViewPages]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'8px'},children:[/*#__PURE__*/_jsx(PageButton,{onClick:()=>setMultiViewPage(p=>Math.max(1,p-1)),disabled:multiViewPage===1,children:/*#__PURE__*/_jsx(IconArrowBack,{})}),/*#__PURE__*/_jsx(PageButton,{onClick:()=>setMultiViewPage(p=>Math.min(totalMultiViewPages,p+1)),disabled:multiViewPage===totalMultiViewPages,children:/*#__PURE__*/_jsx(IconArrowForward,{})})]})]})]})}),/*#__PURE__*/_jsxs(PaginationContainer,{children:[/*#__PURE__*/_jsxs(PaginationText,{children:[\"Question \",isSingleView?currentItem.content.question_number:'Page View',\" of \",structuredItems.length]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'8px'},children:[/*#__PURE__*/_jsx(PageButton,{onClick:handlePrev,disabled:currentIndex===0,style:{color:currentIndex===0?'#757575':'#673AB7'},children:/*#__PURE__*/_jsx(IconArrowBack,{})}),/*#__PURE__*/_jsx(PageButton,{onClick:handleNext,disabled:currentIndex===structuredItems.length-1,style:{color:currentIndex===structuredItems.length-1?'#757575':'#673AB7'},children:/*#__PURE__*/_jsx(IconArrowForward,{})})]})]}),/*#__PURE__*/_jsx(AlertModal,{isOpen:alertInfo.isOpen,message:alertInfo.message,onConfirm:handleAlertConfirm})]});};const RenderCaseStudy=_ref0=>{let{caseStudy}=_ref0;const[expanded,setExpanded]=useState(false);return/*#__PURE__*/_jsxs(CaseStudyContainer,{children:[/*#__PURE__*/_jsxs(CaseStudyHeader,{children:[/*#__PURE__*/_jsx(IconCaseStudy,{}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(CaseStudyLabel,{children:\"Case Study\"}),caseStudy.title]}),/*#__PURE__*/_jsxs(CaseStudyQuestions,{children:[\"Questions: \",caseStudy.questionsCount]}),/*#__PURE__*/_jsxs(CaseStudyToggle,{onClick:()=>setExpanded(!expanded),children:[expanded?'Hide':'Show',\" \",expanded?/*#__PURE__*/_jsx(IconArrowBack,{style:{transform:'rotate(90deg)'}}):/*#__PURE__*/_jsx(IconArrowForward,{style:{transform:'rotate(90deg)'}})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative'},children:[/*#__PURE__*/_jsx(CaseStudyContent,{$expanded:expanded,children:/*#__PURE__*/_jsx(HtmlRenderer,{htmlString:caseStudy.description})}),expanded&&/*#__PURE__*/_jsxs(HideButtonBottom,{onClick:()=>setExpanded(false),children:[\"Hide \",/*#__PURE__*/_jsx(IconArrowBack,{style:{transform:'rotate(90deg)'}})]})]})]});};const AlertModal=_ref1=>{let{isOpen,message,onConfirm// 👈 Change onClose to onConfirm\n}=_ref1;if(!isOpen)return null;const modalStyle={position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.6)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000};const contentStyle={backgroundColor:'white',padding:'30px',borderRadius:'12px',maxWidth:'500px',boxShadow:'0 5px 15px rgba(0,0,0,0.3)',textAlign:'center',lineHeight:1.6};return/*#__PURE__*/_jsxs(\"div\",{style:modalStyle,onClick:onConfirm,children:[\" \",/*#__PURE__*/_jsxs(\"div\",{style:contentStyle,onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"p\",{children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onConfirm// 👈 Use onConfirm here\n,style:{marginTop:'20px',padding:'10px 24px',border:'none',backgroundColor:'#673AB7',color:'white',borderRadius:'8px',cursor:'pointer',fontWeight:600},children:\"OK\"})]})]});};const RenderQuestion=_ref10=>{var _ref11,_question$references;let{question,showAnswer,setShowAnswer,onLinkClick}=_ref10;const handleLinkClick=e=>{const target=e.target;if(target.tagName==='A'){e.preventDefault();// Still prevent the default to call our custom handler\nconst href=target.getAttribute('href');if(href){onLinkClick(href);// 👈 Use the prop to call the function in the parent\n}}};// Defensive extraction with fallback\nconst answerArray=Array.isArray(question.answer)?question.answer:typeof question.answer===\"string\"&&question.answer.length?[question.answer]:[];const optionsArray=Array.isArray(question.options)?question.options:typeof question.options===\"string\"&&question.options.length?[question.options]:[];// Correct answer display string\nconst correctLetters=answerArray.join(\", \");// Extra fields (handle snake_case and camelCase)\nconst explanation=typeof question.explanation===\"string\"?question.explanation:\"\";const whyIncorrect=typeof question.why_incorrect===\"string\"?question.why_incorrect:typeof question.whyIncorrect===\"string\"?question.whyIncorrect:\"\";// References may be array or string\nlet references=(_ref11=(_question$references=question.references)!==null&&_question$references!==void 0?_question$references:question.References)!==null&&_ref11!==void 0?_ref11:\"\";if(Array.isArray(references))references=references.join(\"\\n\");references=typeof references===\"string\"?references:\"\";// \"Has\" checkers\nconst hasExplanation=explanation.trim()!==\"\";const hasWhyIncorrect=whyIncorrect.trim()!==\"\";const hasReferences=references.trim()!==\"\";return/*#__PURE__*/_jsxs(QuestionCardContainer,{style:{background:showAnswer?\"linear-gradient(to bottom, rgba(239,234,254,0.15) 60%, white)\":\"white\",borderRadius:18,boxShadow:\"0 5px 15px rgba(103,58,183,0.04)\",marginBottom:24},children:[/*#__PURE__*/_jsxs(QuestionHeader,{children:[/*#__PURE__*/_jsxs(QuestionNumber,{children:[\"Q: \",question.question_number||question.id||\"\"]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(HtmlRenderer,{htmlString:typeof question.question===\"string\"?question.question:\"\"})})]}),optionsArray.length>0&&/*#__PURE__*/_jsx(Label,{children:\"Options\"}),/*#__PURE__*/_jsx(OptionsList,{children:optionsArray.map((opt,index)=>{const letter=String.fromCharCode(65+index);// Prepare all possible representations of the answer\nconst answerSet=new Set(answerArray.flatMap(a=>a.split(/,\\s*/))// Splits \"A, C\" into [\"A\", \"C\"]\n.map(a=>a.trim().toUpperCase()));// Compare by letter (\"A\", \"B\", etc)\nconst letterIsCorrect=answerSet.has(letter.toUpperCase());// Compare by text (full option value, stripped and uppercased)\nconst valueIsCorrect=answerSet.has(opt.trim().toUpperCase())||answerSet.has(opt.trim());// Highlight if either matches\nconst isCorrect=showAnswer&&(letterIsCorrect||valueIsCorrect);return/*#__PURE__*/_jsxs(OptionItem,{$isCorrect:isCorrect,children:[/*#__PURE__*/_jsxs(\"b\",{children:[letter,\": \"]}),/*#__PURE__*/_jsx(\"span\",{style:{display:\"inline\"},children:/*#__PURE__*/_jsx(HtmlRenderer,{htmlString:typeof opt===\"string\"?opt.replace(/^[A-Z][\\.\\)]\\s*/,\"\"):\"\"})})]},index);})}),/*#__PURE__*/_jsx(ActionButtons,{children:/*#__PURE__*/_jsx(PrimaryButton,{onClick:()=>setShowAnswer(!showAnswer),children:/*#__PURE__*/_jsxs(_Fragment,{children:[showAnswer?/*#__PURE__*/_jsx(IconEyeSlash,{}):/*#__PURE__*/_jsx(IconEye,{}),\" \",showAnswer?\"Hide Answer\":\"Show Answer\"]})})}),showAnswer&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{borderTop:\"1.1px solid #E0E0E0\",margin:\"32px 0\"}}),/*#__PURE__*/_jsx(CorrectAnswerSection,{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(CorrectLabel,{children:\"Correct Answer:\"}),\" \",/*#__PURE__*/_jsx(CorrectText,{children:correctLetters})]})}),hasExplanation&&/*#__PURE__*/_jsxs(ExplanationSection,{children:[/*#__PURE__*/_jsx(Label,{children:\"Explanation\"}),/*#__PURE__*/_jsx(HtmlRenderer,{htmlString:explanation}),/*#__PURE__*/_jsx(\"div\",{style:{textAlign:\"right\",marginTop:10}})]}),hasWhyIncorrect&&/*#__PURE__*/_jsxs(ExplanationSection,{children:[/*#__PURE__*/_jsx(Label,{children:\"Why Incorrect Options are Wrong\"}),/*#__PURE__*/_jsx(HtmlRenderer,{htmlString:formatParagraphs(whyIncorrect)})]}),hasReferences&&/*#__PURE__*/// 👇 And attach handler here\n_jsxs(ExplanationSection,{onClick:handleLinkClick,children:[/*#__PURE__*/_jsx(Label,{children:\"References\"}),/*#__PURE__*/_jsx(HtmlRenderer,{htmlString:formatParagraphs(references)})]})]})]});};export default SimulationPage;","map":{"version":3,"names":["React","useState","useEffect","styled","useParams","useLocation","supabase","HtmlRenderer","useDebounce","useUser","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","formatParagraphs","text","urlRegex","split","filter","line","trim","map","lineWithLinks","replace","url","href","startsWith","join","IconSearch","width","height","viewBox","fill","xmlns","children","d","IconDownload","IconEye","IconEyeSlash","IconTopicFolder","_ref","style","fillOpacity","IconCaseStudy","IconArrowBack","_ref2","IconArrowForward","_ref3","transform","flattenItems","topics","flatList","Object","entries","forEach","_ref4","topicKey","topic","topic_name","push","type","content","title","caseStudyCount","case_study","_topic$questions","description","questionsCount","questions","length","q","qIndex","question_number","toString","PageContainer","div","HeaderContainer","FileName","h2","HeaderActions","DownloadButtonText","span","ViewToggle","Switch","input","attrs","GoToButton","button","DownloadButton","GoToFieldContainer","_ref5","$show","GoToInput","GoButton","ContentContainer","TopicHeader","CaseStudyContainer","CaseStudyHeader","CaseStudyLabel","p","CaseStudyQuestions","CaseStudyToggle","CaseStudyContent","_ref6","$expanded","HideButtonBottom","QuestionCardContainer","QuestionHeader","QuestionNumber","Label","OptionsList","OptionItem","_ref7","$isCorrect","_ref8","_ref9","ActionButtons","PrimaryButton","CorrectAnswerSection","CorrectLabel","CorrectText","ExplanationSection","PaginationContainer","PageButton","LoadingContainer","PaginationText","SimulationPage","_location$state","_currentItem$parent","_currentItem$parent2","_currentItem$parent3","_currentItem$parent$c","fileId","simulationData","setSimulationData","structuredItems","setStructuredItems","currentIndex","setCurrentIndex","isLoading","setLoading","showAnswer","setShowAnswer","isSingleView","setIsSingleView","showGoToField","setShowGoToField","goToInput","setGoToInput","showAnswersMap","setShowAnswersMap","user","location","multiViewPage","setMultiViewPage","startIndex","state","debouncedIndex","alertInfo","setAlertInfo","isOpen","message","handleReferenceLinkClick","handleAlertConfirm","link","document","createElement","target","rel","click","getSimulationData","_data$aiParsedData","_data$aiParsedData$re","data","error","from","select","eq","single","console","result","fileName","filename","newStructuredItems","globalQNum","values","_topic$questions2","parent","caseStudyTitle","undefined","caseStudyDescription","caseStudyQuestionsCount","saveProgress","upsert","user_id","id","last_viewed_file_id","product_name","last_viewed_question_index","total_questions","updated_at","Date","toISOString","handleNext","prev","Math","min","handlePrev","max","currentItem","itemsPerPage","allMultiViewItems","totalMultiViewPages","ceil","paginatedMultiViewItems","slice","color","checked","onChange","e","onClick","value","placeholder","parseInt","alert","fontSize","RenderCaseStudy","caseStudy","RenderQuestion","question","onLinkClick","item","index","newVal","display","gap","disabled","AlertModal","onConfirm","_ref0","expanded","setExpanded","flex","position","htmlString","_ref1","modalStyle","top","left","right","bottom","backgroundColor","alignItems","justifyContent","zIndex","contentStyle","padding","borderRadius","maxWidth","boxShadow","textAlign","lineHeight","stopPropagation","marginTop","border","cursor","fontWeight","_ref10","_ref11","_question$references","handleLinkClick","tagName","preventDefault","getAttribute","answerArray","Array","isArray","answer","optionsArray","options","correctLetters","explanation","whyIncorrect","why_incorrect","references","References","hasExplanation","hasWhyIncorrect","hasReferences","background","marginBottom","opt","letter","String","fromCharCode","answerSet","Set","flatMap","a","toUpperCase","letterIsCorrect","has","valueIsCorrect","isCorrect","borderTop","margin"],"sources":["/Users/megamac/Dev/GitHub/projects/certempire-react/src/pages/SimulationPage.tsx"],"sourcesContent":["// src/pages/SimulationPage.tsx\nimport React, { useState, useEffect, CSSProperties } from 'react';\nimport styled from 'styled-components';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { supabase } from '../supabaseClient';\nimport HtmlRenderer from '../components/utils/HtmlRenderer'; // 1. Import the new component\nimport { useDebounce } from 'use-debounce';\nimport { useUser } from '../context/UserContext';\n\n// HELPERS\n\n// --- Helper function ---\nconst formatParagraphs = (text: string): string => {\n  if (!text || typeof text !== 'string') {\n    return \"\";\n  }\n\n  // Regex to find URLs (http, https, or www domains)\n  const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n\n  return text\n    .split('\\n')\n    .filter(line => line.trim() !== '')\n    .map(line => {\n      // Find and replace URLs within the line with <a> tags\n      const lineWithLinks = line.replace(urlRegex, (url) => {\n        // Prepend 'http://' to www links for them to work correctly\n        const href = url.startsWith('www.') ? `http://${url}` : url;\n        // Return the HTML link tag\n        return `<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${url}</a>`;\n      });\n      // Wrap the entire processed line in a <p> tag\n      return `<p>${lineWithLinks}</p>`;\n    })\n    .join('');\n};\n\n// --- Type Definitions ---\ntype Question = {\n  answer: string[];\n  options: string[];\n  question: string;\n  explanation: string;\n  question_number: string;\n  why_incorrect?: string;\n  references?: string;\n};\ntype Topic = { questions: Question[]; case_study?: string; topic_name?: string; };\ntype SimulationData = { fileName: string; topics: Record<string, Topic>; };\ntype SupabaseFile = { 'ai-parsed-data': { result: { topics: Record<string, Topic>; }; }; filename: string; };\ntype StructuredItem = { type: 'question'; content: Question; parent?: { topic?: string | undefined; caseStudyTitle?: string | undefined; caseStudyDescription?: string | undefined; caseStudyQuestionsCount?: number | undefined; } };\n// --- SVG Icons ---\nconst IconSearch = () => <svg width=\"20\" height=\"20\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159L11.5 12.5L12.5 11.5L10.0158 9.30885C9.42248 9.75587 8.68594 10.0345 7.89932 10.0883L6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5C10 7.50556 9.61334 8.42373 9.00001 9.13098L9.30884 10.0159Z\" fill=\"#757575\"></path></svg>;\nconst IconDownload = () => <svg width=\"18\" height=\"18\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M4 6H2V12.5C2 12.7761 2.22386 13 2.5 13H12.5C12.7761 13 13 12.7761 13 12.5V6H11V12H4V6ZM7.5 10L11 5H8V2H7V5H4L7.5 10Z\" fill=\"currentColor\"></path></svg>;\nconst IconEye = () => <svg width=\"16\" height=\"16\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7.5 11C4.79322 11 2.49241 9.2993 1.05532 7.50001C2.49241 5.70072 4.79322 4 7.5 4C10.2068 4 12.5076 5.70072 13.9447 7.50001C12.5076 9.2993 10.2068 11 7.5 11ZM7.5 3C4.33776 3 1.68988 5.00373 0.160645 6.88398L0.116041 6.94165C-0.0386803 7.14378 -0.0386803 7.85624 0.116041 8.05837L0.160645 8.11604C1.68988 9.99629 4.33776 12 7.5 12C10.6622 12 13.3101 9.99629 14.8394 8.11604L14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398C13.3101 5.00373 10.6622 3 7.5 3ZM7.5 9C6.40237 9 5.50655 8.11289 5.5 7.00001C5.50655 5.88713 6.40237 5.00001 7.5 5.00001C8.59763 5.00001 9.49345 5.88713 9.5 7.00001C9.49345 8.11289 8.59763 9 7.5 9Z\" fill=\"currentColor\"></path></svg>;\nconst IconEyeSlash = () => <svg width=\"16\" height=\"16\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1.3415 13.6585L13.6582 1.34176L12.9511 0.634691L0.634433 12.9514L1.3415 13.6585ZM4.39893 9.60107C3.13626 8.87784 2.15372 7.84628 1.05532 7.5C2.49241 5.70072 4.79322 4 7.5 4C8.61439 4 9.66427 4.29891 10.584 4.80878L9.49989 6.00001C9.49561 5.92548 9.24345 5.88713 9.5 7C9.49345 8.11289 8.59763 9 7.5 9C6.81406 9 6.20237 8.68594 5.86902 8.13098L4.39893 9.60107ZM14.8394 6.88398C13.5936 5.25338 11.6622 3 7.5 3C6.59763 3 5.75655 3.20237 5.00001 3.55837L6.50001 5C6.40237 5 5.50655 5.88713 5.5 7C5.50655 7.24345 5.57452 7.46548 5.68988 7.68988L7.584 9.584C8.75655 9.42548 9.49345 8.49345 9.5 7.41594L13.8839 12.8394C14.4934 12.1129 14.8394 11.2434 14.8394 10.5C14.8394 9.99629 13.3101 8.11604 14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398Z\" fill=\"currentColor\"></path></svg>;\nconst IconTopicFolder = ({ style = {} }: { style?: CSSProperties }) => <svg style={style} width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M3 5C3 4.44772 3.44772 4 4 4H9.17157C9.58052 4 9.91096 4.24065 10.0607 4.58579L10.5858 5.75736C10.7355 6.1025 11.0659 6.34315 11.4749 6.34315H20C20.5523 6.34315 21 6.79086 21 7.34315V18C21 18.5523 20.5523 19 20 19H4C3.44772 19 3 18.5523 3 18V5Z\" fill=\"#000000\" fillOpacity=\"0.7\" /></svg>;\nconst IconCaseStudy = () => <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M4 4H20V20H4V4ZM3 3V21H21V3H3ZM6 6H18V8H6V6ZM6 10H18V12H6V10ZM6 14H14V16H6V14Z\" fill=\"#673AB7\"></path></svg>;\nconst IconArrowBack = ({ style = {} }: { style?: CSSProperties }) => <svg style={style} width=\"20\" height=\"20\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M6.85355 3.14645C7.04882 3.34171 7.04882 3.65829 6.85355 3.85355L3.70711 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H3.70711L6.85355 11.1464C7.04882 11.3417 7.04882 11.6583 6.85355 11.8536C6.65829 12.0488 6.34171 12.0488 6.14645 11.8536L1.64645 7.35355C1.45118 7.15829 1.45118 6.84171 1.64645 6.64645L6.14645 2.14645C6.34171 1.95118 6.65829 1.95118 6.85355 2.14645Z\" fill=\"currentColor\" /></svg>;\nconst IconArrowForward = ({ style = {} }: { style?: CSSProperties }) => <svg style={style} width=\"20\" height=\"20\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.14645 3.14645C8.34171 3.34171 8.34171 3.65829 8.14645 3.85355L4.99999 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H5L8.14645 11.1464C8.34171 11.3417 8.34171 11.6583 8.14645 11.8536C7.95118 12.0488 7.6346 12.0488 7.43934 11.8536L2.93934 7.35355C2.74408 7.15829 2.74408 6.84171 2.93934 6.64645L7.43934 2.14645C7.6346 1.95118 7.95118 1.95118 8.14645 2.14645Z\" fill=\"currentColor\" transform=\"scale(-1,1) translate(-15,0)\" /></svg>;\n\n// --- Helper function ---\nconst flattenItems = (topics: Record<string, Topic>): { type: string; content: any }[] => {\n  const flatList: { type: string; content: any }[] = [];\n  Object.entries(topics).forEach(([topicKey, topic]: [string, Topic]) => {\n    if (topic.topic_name) {\n      flatList.push({ type: 'topic', content: { title: topic.topic_name, caseStudyCount: topic.case_study ? 1 : 0 } });\n    }\n    if (topic.case_study) {\n      flatList.push({ type: 'case_study', content: { title: topic.topic_name || topicKey, description: topic.case_study, questionsCount: topic.questions?.length || 0 } });\n    }\n    (topic.questions || []).forEach((q: Question, qIndex: number) => {\n      flatList.push({ type: 'question', content: { ...q, question_number: q.question_number || (qIndex + 1).toString() } });\n    });\n  });\n  return flatList;\n};\n\n// --- Styled Components (Full Definitions) ---\nconst PageContainer = styled.div` display: flex; flex-direction: column; gap: 16px; `;\nconst HeaderContainer = styled.div`\n  @media (min-width: 651px) { display: flex; flex-direction: row; align-items: center; justify-content: space-between; gap: 16px; }\n  @media (max-width: 650px) { display: flex; flex-direction: column; gap: 16px; }\n`;\nconst FileName = styled.h2` color: #2c2c54; font-weight: bold; font-size: 22px; `;\nconst HeaderActions = styled.div` display: flex; align-items: center; gap: 12px; `;\n\nconst DownloadButtonText = styled.span`\n  display: inline;\n  @media (max-width: 650px) {\n    display: none;\n  }\n`;\n\nconst ViewToggle = styled.div`\n  display: flex; align-items: center; gap: 4px; padding: 4px 8px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px;\n  span { font-weight: bold; color: #757575; }\n  svg { color: #757575; }\n`;\nconst Switch = styled.input.attrs({ type: 'checkbox' })`\n  appearance: none; width: 34px; height: 20px; background: #E0E0E0; border-radius: 10px; position: relative; cursor: pointer;\n  &:checked { background: #673AB7; }\n  &::before { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: 0.2s; }\n  &:checked::before { left: 16px; }\n`;\nconst GoToButton = styled.button`\n  background: none; border: 1px solid #E0E0E0; padding: 8px 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; color: #757575;\n`;\nconst DownloadButton = styled.button`\n  background-color: #673AB7; color: white; border: none; border-radius: 12px; padding: 10px 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px;\n  @media (max-width: 650px) { padding: 12px; border-radius: 50%; }\n`;\nconst GoToFieldContainer = styled.div<{ $show: boolean }>`\n  height: ${({ $show }) => $show ? '60px' : '0'}; display: flex; justify-content: center; align-items: center; gap: 8px; overflow: hidden; transition: height 0.3s;\n`;\nconst GoToInput = styled.input` width: 150px; text-align: center; border: 1px solid #E0E0E0; border-radius: 8px; padding: 8px; `;\nconst GoButton = styled.button` background-color: #673AB7; color: white; border: none; padding: 8px 16px; border-radius: 8px; `;\nconst ContentContainer = styled.div` background-color: white; border-radius: 12px; border: 1px solid #E0E0E0; `;\nconst TopicHeader = styled.div` padding: 24px 16px 16px; display: flex; align-items: center; gap: 16px; font-size: 20px; font-weight: bold; color: #424242; span { font-weight: 500; } `;\nconst CaseStudyContainer = styled.div` background-color: rgba(239, 234, 254, 0.4); border-bottom: 1px solid rgba(103, 58, 183, 0.2); padding: 26px; `;\nconst CaseStudyHeader = styled.div` display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: bold; color: #673AB7; @media (max-width: 500px) { flex-direction: column; align-items: flex-start; } `;\nconst CaseStudyLabel = styled.p` color: #BDBDBD; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; `;\nconst CaseStudyQuestions = styled.span` font-size: 14px; font-weight: 500; color: #757575; `;\nconst CaseStudyToggle = styled.button` background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;\nconst CaseStudyContent = styled.div<{ $expanded: boolean }>`\n  max-height: ${({ $expanded }) => $expanded ? 'none' : '50px'}; overflow: hidden; transition: max-height 0.3s; \n`;\nconst HideButtonBottom = styled.button` position: absolute; bottom: 10px; right: 10px; background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;\nconst QuestionCardContainer = styled.div` padding: 26px; `;\nconst QuestionHeader = styled.div` @media (min-width: 601px) { display: flex; align-items: flex-start; gap: 18px; } @media (max-width: 600px) { display: flex; flex-direction: column; gap: 16px; } `;\nconst QuestionNumber = styled.div` background-color: rgba(103, 58, 183, 0.12); color: #673AB7; font-weight: bold; font-size: 16px; padding: 12px; border-radius: 10px; `;\nconst Label = styled.p` color:rgb(131, 129, 131); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; margin-top: 20px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `; const OptionsList = styled.div` display: flex; flex-direction: column; gap: 11px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `;\n// This is the only change you need\n\nconst OptionItem = styled.div<{ $isCorrect: boolean }>`\n  display: flex;\n align-items: baseline;\n  gap: 8px;\n  border: 1px solid ${({ $isCorrect }) => $isCorrect ? '#38b000' : '#E0E0E0'};\n  background: ${({ $isCorrect }) => $isCorrect ? '#F4FBF6' : 'transparent'};\n  border-radius: 8px;\n  padding: 11px 14px;\n  font-size: 15px;\n  line-height: 1.35;\n  transition: all 0.14s;\n  box-shadow: ${({ $isCorrect }) => $isCorrect ? '0 2px 6px rgba(56,176,0,0.1)' : 'none'};\n`;\nconst ActionButtons = styled.div` display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 8px; margin-top: 26px; `;\nconst PrimaryButton = styled.button` border: none; background-color: #673AB7; color: white; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; `;\nconst CorrectAnswerSection = styled.div` display: flex; align-items: center; gap: 8px; padding: 12px 0; @media (max-width: 600px) { flex-direction: column; align-items: flex-start; gap: 16px; } `;\nconst CorrectLabel = styled.span`\n  display: block; /* ✅ Stacks the elements vertically */\n  color:rgb(0, 0, 0);\n  font-weight: 600;\n  font-size: 13px;\n  margin-bottom: 5px;\n`;\n\nconst CorrectText = styled.span`\n  font-weight: regular;\n  font-size: 15px;\n`;\nconst ExplanationSection = styled.div` margin-top: 8px; `;\nconst PaginationContainer = styled.div` display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px; `;\nconst PageButton = styled.button` background: none; border: 1px solid #E0E0E0; color: #333; padding: 8px 16px; border-radius: 8px; cursor: pointer; &:disabled { cursor: not-allowed; opacity: 0.5; } `;\nconst LoadingContainer = styled.div` display: flex; justify-content: center; align-items: center; height: 300px; font-size: 18px; color: #757575;`;\nconst PaginationText = styled.span` color: #757575; font-weight: 500; `;\n\n// --- The Main Page Component ---\n\n// STATE HOOKS\n\nconst SimulationPage = () => {\n  const { fileId } = useParams<{ fileId: string }>();\n  const [simulationData, setSimulationData] = useState<SimulationData | null>(null);\n  const [structuredItems, setStructuredItems] = useState<StructuredItem[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isLoading, setLoading] = useState(true);\n  const [showAnswer, setShowAnswer] = useState(false);\n  const [isSingleView, setIsSingleView] = useState(true);\n  const [showGoToField, setShowGoToField] = useState(false);\n  const [goToInput, setGoToInput] = useState('');\n  const [showAnswersMap, setShowAnswersMap] = useState<Record<string, boolean>>({});\n  const { user } = useUser();\n  const location = useLocation();\n  const [multiViewPage, setMultiViewPage] = useState(1);\n  const startIndex = location.state?.startIndex;\n  const [debouncedIndex] = useDebounce(currentIndex, 1500); // Saves 1.5s after user stops\n  const [alertInfo, setAlertInfo] = useState({ isOpen: false, message: \"\", href: null as string | null });\n\n  const handleReferenceLinkClick = (href: string) => {\n    setAlertInfo({\n      isOpen: true,\n      href: href, // Store the link to open\n      message: \"You are accessing a reference link. Before you move out, please remember that platforms keep changing their URLs for such documents, and by the time you click it, it might have changed. In case the link is broken or returns a \\\"Not Found,\\\" error, the best way is to search the reference doc online. Thank you.\"\n    });\n  };\n\n  const handleAlertConfirm = () => {\n    // This function runs when \"OK\" is clicked.\n    if (alertInfo.href) {\n      // This method is more likely to open a new tab instead of a new window.\n      const link = document.createElement('a');\n      link.href = alertInfo.href;\n      link.target = '_blank';\n      link.rel = 'noopener noreferrer';\n      link.click();\n    }\n    // Close the modal\n    setAlertInfo({ isOpen: false, message: \"\", href: null });\n  };\n\n  useEffect(() => {\n    if (!fileId) return;\n    async function getSimulationData() {\n      setLoading(true);\n      const { data, error } = await supabase.from('files').select('filename, ai-parsed-data').eq('id', fileId).single<SupabaseFile>();\n      if (error) {\n        console.error(\"Error fetching file:\", error);\n      } else if (data && data['ai-parsed-data']?.result?.topics) {\n        const topics = data['ai-parsed-data'].result.topics;\n        setSimulationData({ fileName: data.filename, topics: topics });\n        const newStructuredItems: StructuredItem[] = [];\n        let globalQNum = 1;\n        Object.values(topics).forEach((topic: Topic) => {\n          (topic.questions || []).forEach((q: Question) => {\n            newStructuredItems.push({\n              type: 'question',\n              content: { ...q, question_number: (globalQNum++).toString() },\n              parent: { topic: topic.topic_name, caseStudyTitle: topic.case_study ? topic.topic_name : undefined, caseStudyDescription: topic.case_study ? topic.case_study : undefined, caseStudyQuestionsCount: topic.case_study ? (topic.questions?.length || 0) : 0 }\n            });\n          });\n        });\n        setStructuredItems(newStructuredItems);\n        if (startIndex && startIndex > 0 && startIndex < newStructuredItems.length) {\n          setCurrentIndex(startIndex);\n        }\n      }\n\n      setLoading(false);\n    }\n    getSimulationData();\n  }, [fileId]);\n\n  useEffect(() => {\n    setShowAnswer(false);\n  }, [currentIndex]);\n\n  // --- This entire block is new ---\n  useEffect(() => {\n    const saveProgress = async () => {\n      // Use the user object directly from your context\n      if (!user || !fileId || !simulationData || structuredItems.length === 0) {\n        return;\n      }\n\n      const { error } = await supabase.from('user_progress').upsert({\n        // This now sends the correct numeric WordPress ID\n        user_id: user.id,\n        last_viewed_file_id: fileId,\n        product_name: simulationData.fileName,\n        last_viewed_question_index: debouncedIndex,\n        total_questions: structuredItems.length,\n        updated_at: new Date().toISOString(),\n      });\n\n      if (error) {\n        console.error(\"Supabase error saving progress:\", error);\n      }\n    };\n\n    // Only save if the user has actually navigated to a question\n    saveProgress();\n\n  }, [debouncedIndex, user, fileId, simulationData, structuredItems.length]); // Dependencies\n\n  useEffect(() => {\n    setCurrentIndex(0);\n    setShowAnswersMap({});\n    setShowAnswer(false);\n    setMultiViewPage(1);\n  }, [isSingleView]);\n\n  const handleNext = () => setCurrentIndex(prev => Math.min(prev + 1, structuredItems.length - 1));\n  const handlePrev = () => setCurrentIndex(prev => Math.max(prev - 1, 0));\n\n  const currentItem = structuredItems[currentIndex];\n\n  if (isLoading) return <LoadingContainer>Loading Simulation...</LoadingContainer>;\n  if (!currentItem) return <LoadingContainer>Could not load questions for this file.</LoadingContainer>;\n\n  // ✅ CALCULATE PAGINATION FOR MULTI-VIEW\n  const itemsPerPage = 25;\n  const allMultiViewItems = flattenItems(simulationData?.topics || {});\n  const totalMultiViewPages = Math.ceil(allMultiViewItems.length / itemsPerPage);\n  // Get the 25 items for the current page\n  const paginatedMultiViewItems = allMultiViewItems.slice(\n    (multiViewPage - 1) * itemsPerPage,\n    multiViewPage * itemsPerPage\n  );\n\n  return (\n    <PageContainer>\n      <HeaderContainer>\n        <FileName title={simulationData?.fileName}>{simulationData?.fileName}</FileName>\n        <HeaderActions>\n          <ViewToggle>\n            <span>View:</span>\n            <IconTopicFolder style={{ color: !isSingleView ? '#673AB7' : '#757575', width: 20, height: 20 }} />\n            <Switch checked={isSingleView} onChange={(e) => setIsSingleView(e.target.checked)} />\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style={{ color: isSingleView ? '#673AB7' : '#757575' }}><path d=\"M4 6H20V8H4V6ZM4 11H20V13H4V11ZM4 16H20V18H4V16Z\" fill=\"currentColor\" /></svg>\n          </ViewToggle>\n          <GoToButton onClick={() => setShowGoToField(!showGoToField)}>\n            <IconSearch /> Go To\n          </GoToButton>\n          <DownloadButton onClick={() => { /* ... */ }}>\n            <IconDownload />\n            <DownloadButtonText>Download</DownloadButtonText>\n          </DownloadButton>\n        </HeaderActions>\n      </HeaderContainer>\n\n      <GoToFieldContainer $show={showGoToField}>\n        <GoToInput type=\"number\" value={goToInput} onChange={(e) => setGoToInput(e.target.value)} placeholder=\"Go to...\" />\n        <GoButton onClick={() => {\n          const target = parseInt(goToInput);\n          if (target >= 1 && target <= structuredItems.length) {\n            setCurrentIndex(target - 1);\n            setIsSingleView(true);\n            setShowGoToField(false);\n            setGoToInput('');\n          } else {\n            alert(`Enter a number between 1 and ${structuredItems.length}`);\n          }\n        }}>Go</GoButton>\n      </GoToFieldContainer>\n\n      <ContentContainer>\n        {isSingleView ? (\n          // --- Single View (no changes here) ---\n          <>\n            {currentItem.parent?.topic && (\n              <TopicHeader>\n                <IconTopicFolder />\n                <div>\n                  <span>Topic: </span>{currentItem.parent.topic}\n                  {currentItem.parent?.caseStudyDescription && <div style={{ fontSize: 14, color: '#757575' }}>Case Studies: 1</div>}\n                </div>\n              </TopicHeader>\n            )}\n            {currentItem.parent?.caseStudyTitle && <RenderCaseStudy caseStudy={{ title: currentItem.parent.caseStudyTitle || 'Case Study', description: currentItem.parent.caseStudyDescription || '', questionsCount: currentItem.parent.caseStudyQuestionsCount ?? 0 }} />}\n            <RenderQuestion\n              question={currentItem.content}\n              showAnswer={showAnswer}\n              setShowAnswer={setShowAnswer}\n              onLinkClick={handleReferenceLinkClick}\n            />\n          </>\n        ) : (\n          // --- ✅ MODIFIED MULTI-VIEW WITH PAGINATION ---\n          <>\n            {/* Map over the paginated list, not the full list */}\n            {paginatedMultiViewItems.map((item, index) => (\n              <div key={index}>\n                {item.type === 'topic' && (\n                  <TopicHeader>\n                    <IconTopicFolder />\n                    <div>\n                      <span>Topic: </span>{item.content.title}\n                      {item.content.caseStudyCount > 0 && <div style={{ fontSize: 14, color: '#757575' }}>Case Studies: {item.content.caseStudyCount}</div>}\n                    </div>\n                  </TopicHeader>\n                )}\n                {item.type === 'case_study' && <RenderCaseStudy caseStudy={item.content} />}\n                {item.type === 'question' && (\n                  <RenderQuestion\n                    question={item.content}\n                    showAnswer={showAnswersMap[item.content.question_number] || false}\n                    setShowAnswer={(newVal: boolean) => setShowAnswersMap(prev => ({ ...prev, [item.content.question_number]: newVal }))}\n                    onLinkClick={handleReferenceLinkClick}\n                  />\n                )}\n              </div>\n            ))}\n            {/* Pagination controls for multi-view */}\n            {totalMultiViewPages > 1 && (\n              <PaginationContainer>\n                <PaginationText>Page {multiViewPage} of {totalMultiViewPages}</PaginationText>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  <PageButton onClick={() => setMultiViewPage(p => Math.max(1, p - 1))} disabled={multiViewPage === 1}>\n                    <IconArrowBack />\n                  </PageButton>\n                  <PageButton onClick={() => setMultiViewPage(p => Math.min(totalMultiViewPages, p + 1))} disabled={multiViewPage === totalMultiViewPages}>\n                    <IconArrowForward />\n                  </PageButton>\n                </div>\n              </PaginationContainer>\n            )}\n          </>\n        )}\n      </ContentContainer>\n\n      <PaginationContainer>\n        <PaginationText>Question {isSingleView ? currentItem.content.question_number : 'Page View'} of {structuredItems.length}</PaginationText>\n        <div style={{ display: 'flex', gap: '8px' }}>\n          <PageButton onClick={handlePrev} disabled={currentIndex === 0} style={{ color: currentIndex === 0 ? '#757575' : '#673AB7' }}><IconArrowBack /></PageButton>\n          <PageButton onClick={handleNext} disabled={currentIndex === structuredItems.length - 1} style={{ color: currentIndex === structuredItems.length - 1 ? '#757575' : '#673AB7' }}><IconArrowForward /></PageButton>\n        </div>\n      </PaginationContainer>\n      <AlertModal\n        isOpen={alertInfo.isOpen}\n        message={alertInfo.message}\n        onConfirm={handleAlertConfirm}\n      />\n    </PageContainer>\n  );\n};\n\nconst RenderCaseStudy = ({ caseStudy }: { caseStudy: { title: string; description: string; questionsCount: number } }) => {\n  const [expanded, setExpanded] = useState(false);\n  return (\n    <CaseStudyContainer>\n      <CaseStudyHeader>\n        <IconCaseStudy />\n        <div style={{ flex: 1 }}>\n          <CaseStudyLabel>Case Study</CaseStudyLabel>\n          {caseStudy.title}\n        </div>\n        <CaseStudyQuestions>Questions: {caseStudy.questionsCount}</CaseStudyQuestions>\n        <CaseStudyToggle onClick={() => setExpanded(!expanded)}>\n          {expanded ? 'Hide' : 'Show'} {expanded ? <IconArrowBack style={{ transform: 'rotate(90deg)' }} /> : <IconArrowForward style={{ transform: 'rotate(90deg)' }} />}\n        </CaseStudyToggle>\n      </CaseStudyHeader>\n      <div style={{ position: 'relative' }}>\n        <CaseStudyContent $expanded={expanded}>\n          <HtmlRenderer htmlString={caseStudy.description} />\n        </CaseStudyContent>\n        {expanded && (\n          <HideButtonBottom onClick={() => setExpanded(false)}>\n            Hide <IconArrowBack style={{ transform: 'rotate(90deg)' }} />\n          </HideButtonBottom>\n        )}\n      </div>\n    </CaseStudyContainer>\n  );\n};\n\n\nconst AlertModal = ({\n  isOpen,\n  message,\n  onConfirm, // 👈 Change onClose to onConfirm\n}: {\n  isOpen: boolean;\n  message: string;\n  onConfirm: () => void; // 👈 Change the prop name and type\n}) => {\n  if (!isOpen) return null;\n\n  const modalStyle: React.CSSProperties = {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: 'rgba(0, 0, 0, 0.6)',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    zIndex: 1000,\n  };\n\n  const contentStyle: React.CSSProperties = {\n    backgroundColor: 'white',\n    padding: '30px',\n    borderRadius: '12px',\n    maxWidth: '500px',\n    boxShadow: '0 5px 15px rgba(0,0,0,0.3)',\n    textAlign: 'center',\n    lineHeight: 1.6\n  };\n\n  return (\n    <div style={modalStyle} onClick={onConfirm}> {/* Close on background click */}\n      <div style={contentStyle} onClick={(e) => e.stopPropagation()}>\n        <p>{message}</p>\n        <button\n          onClick={onConfirm} // 👈 Use onConfirm here\n          style={{\n            marginTop: '20px',\n            padding: '10px 24px',\n            border: 'none',\n            backgroundColor: '#673AB7',\n            color: 'white',\n            borderRadius: '8px',\n            cursor: 'pointer',\n            fontWeight: 600\n          }}\n        >\n          OK\n        </button>\n      </div>\n    </div>\n  );\n};\n\n\nconst RenderQuestion = ({\n  question,\n  showAnswer,\n  setShowAnswer,\n  onLinkClick,\n}: {\n  question: any; // Accept \"any\" for robust fallback\n  showAnswer: boolean;\n  setShowAnswer: (val: boolean) => void;\n  onLinkClick: (href: string) => void;\n}) => {\n\n  const handleLinkClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    const target = e.target as HTMLElement;\n    if (target.tagName === 'A') {\n      e.preventDefault(); // Still prevent the default to call our custom handler\n      const href = target.getAttribute('href');\n      if (href) {\n        onLinkClick(href); // 👈 Use the prop to call the function in the parent\n      }\n    }\n  };\n\n  // Defensive extraction with fallback\n  const answerArray = Array.isArray(question.answer)\n    ? question.answer\n    : typeof question.answer === \"string\" && question.answer.length\n      ? [question.answer]\n      : [];\n  const optionsArray = Array.isArray(question.options)\n    ? question.options\n    : typeof question.options === \"string\" && question.options.length\n      ? [question.options]\n      : [];\n\n  // Correct answer display string\n  const correctLetters = answerArray.join(\", \");\n\n  // Extra fields (handle snake_case and camelCase)\n  const explanation =\n    typeof question.explanation === \"string\"\n      ? question.explanation\n      : \"\";\n  const whyIncorrect =\n    typeof question.why_incorrect === \"string\"\n      ? question.why_incorrect\n      : typeof question.whyIncorrect === \"string\"\n        ? question.whyIncorrect\n        : \"\";\n  // References may be array or string\n  let references = question.references ?? question.References ?? \"\";\n  if (Array.isArray(references)) references = references.join(\"\\n\");\n  references = typeof references === \"string\" ? references : \"\";\n\n  // \"Has\" checkers\n  const hasExplanation = explanation.trim() !== \"\";\n  const hasWhyIncorrect = whyIncorrect.trim() !== \"\";\n  const hasReferences = references.trim() !== \"\";\n\n\n  return (\n    <QuestionCardContainer\n      style={{\n        background: showAnswer\n          ? \"linear-gradient(to bottom, rgba(239,234,254,0.15) 60%, white)\"\n          : \"white\",\n        borderRadius: 18,\n        boxShadow: \"0 5px 15px rgba(103,58,183,0.04)\",\n        marginBottom: 24,\n      }}\n    >\n      <QuestionHeader>\n        <QuestionNumber>Q: {question.question_number || question.id || \"\"}</QuestionNumber>\n        <div style={{ flex: 1 }}>\n          <HtmlRenderer htmlString={typeof question.question === \"string\" ? question.question : \"\"} />\n        </div>\n      </QuestionHeader>\n\n      {optionsArray.length > 0 && <Label>Options</Label>}\n      <OptionsList>\n        {optionsArray.map((opt: string, index: number) => {\n          const letter = String.fromCharCode(65 + index);\n          // Prepare all possible representations of the answer\n          const answerSet = new Set(\n            answerArray\n              .flatMap((a: string) => a.split(/,\\s*/)) // Splits \"A, C\" into [\"A\", \"C\"]\n              .map((a: string) => a.trim().toUpperCase())\n          );          // Compare by letter (\"A\", \"B\", etc)\n          const letterIsCorrect = answerSet.has(letter.toUpperCase());\n          // Compare by text (full option value, stripped and uppercased)\n          const valueIsCorrect =\n            answerSet.has(opt.trim().toUpperCase()) ||\n            answerSet.has(opt.trim());\n          // Highlight if either matches\n          const isCorrect = showAnswer && (letterIsCorrect || valueIsCorrect);\n\n          return (\n            <OptionItem key={index} $isCorrect={isCorrect}>\n              <b>{letter}: </b>\n              <span style={{ display: \"inline\" }}>\n                <HtmlRenderer htmlString={typeof opt === \"string\" ? opt.replace(/^[A-Z][\\.\\)]\\s*/, \"\") : \"\"} />\n              </span>\n            </OptionItem>\n          );\n        })}\n      </OptionsList>\n\n      <ActionButtons>\n        <PrimaryButton onClick={() => setShowAnswer(!showAnswer)}>\n          <>\n            {showAnswer ? <IconEyeSlash /> : <IconEye />}{\" \"}\n            {showAnswer ? \"Hide Answer\" : \"Show Answer\"}\n          </>\n        </PrimaryButton>\n      </ActionButtons>\n\n      {showAnswer && (\n        <>\n          <div style={{ borderTop: \"1.1px solid #E0E0E0\", margin: \"32px 0\" }} />\n          <CorrectAnswerSection>\n            <div>\n              <CorrectLabel>Correct Answer:</CorrectLabel>{\" \"}\n              <CorrectText>{correctLetters}</CorrectText>\n            </div>\n            {/*         <ReportButton\n              style={{ marginLeft: \"auto\" }}\n              onClick={() => alert(\"Report answer submitted\")}\n            >\n              <IconWarning /> Report Answer as Incorrect\n            </ReportButton>\n\n                                              */}\n\n          </CorrectAnswerSection>\n\n          {hasExplanation && (\n            <ExplanationSection>\n              <Label>Explanation</Label>\n              <HtmlRenderer htmlString={explanation} />\n              <div style={{ textAlign: \"right\", marginTop: 10 }}>\n\n              </div>\n            </ExplanationSection>\n          )}\n\n          {hasWhyIncorrect && (\n            <ExplanationSection>\n              <Label>Why Incorrect Options are Wrong</Label>\n              <HtmlRenderer htmlString={formatParagraphs(whyIncorrect)} />\n            </ExplanationSection>\n          )}\n\n          {hasReferences && (\n            // 👇 And attach handler here\n            <ExplanationSection onClick={handleLinkClick}>\n              <Label>References</Label>\n              <HtmlRenderer htmlString={formatParagraphs(references)} />\n            </ExplanationSection>\n          )}\n        </>\n      )}\n    </QuestionCardContainer>\n  );\n};\n\n\n\n\nexport default SimulationPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}