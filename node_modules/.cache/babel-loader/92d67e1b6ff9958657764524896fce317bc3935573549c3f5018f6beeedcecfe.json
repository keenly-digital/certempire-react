{"ast":null,"code":"var _jsxFileName = \"/Users/megamac/Dev/GitHub/projects/certempire-react/src/pages/AccountDetailsPage.tsx\",\n  _s = $RefreshSig$();\n// src/pages/AccountDetailsPage.tsx\nimport React, { useState, useEffect } from 'react';\nimport { useUser } from '../context/UserContext';\nimport { supabase } from '../supabaseClient';\n\n// --- Types ---\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// --- Styled Components (from your file) ---\n// ... All your styled components remain here ...\n\nconst AccountDetailsPage = () => {\n  _s();\n  const {\n    user\n  } = useUser();\n  const [formData, setFormData] = useState(null);\n  const [passwordData, setPasswordData] = useState({\n    newPassword: '',\n    confirmPassword: ''\n  });\n  const [isLoading, setLoading] = useState(true);\n  const [isSaving, setSaving] = useState(false);\n  const [isSavingPassword, setSavingPassword] = useState(false);\n\n  // --- useEffect to fetch data remains the same ---\n  useEffect(() => {/* ... */}, [user]);\n\n  // --- handleInputChange is now fixed ---\n  const handleInputChange = e => {/* ... as fixed in Part 1 ... */};\n  const handlePasswordChange = e => {\n    setPasswordData({\n      ...passwordData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // --- handleSubmit for main details ---\n  const handleSubmit = async e => {/* ... */};\n\n  // --- New handler for password change ---\n  const handlePasswordSubmit = async e => {\n    e.preventDefault();\n    if (!user) return;\n\n    // 1. Validation Check\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\n      alert(\"Error: New passwords do not match.\");\n      return;\n    }\n    if (!passwordData.newPassword) {\n      alert(\"Error: New password cannot be blank.\");\n      return;\n    }\n    setSavingPassword(true);\n    try {\n      const {\n        data,\n        error\n      } = await supabase.functions.invoke('get-wc-data', {\n        body: {\n          method: 'POST',\n          endpoint: 'cwc/customer/set-password',\n          customer_id: user.id,\n          new_password: passwordData.newPassword\n        }\n      });\n      if (error) throw error;\n      alert('Password updated successfully!');\n      setPasswordData({\n        newPassword: '',\n        confirmPassword: ''\n      }); // Clear fields\n    } catch (err) {\n      console.error(\"Error updating password:\", err);\n      alert('Failed to update password.');\n    } finally {\n      setSavingPassword(false);\n    }\n  };\n  if (isLoading || !formData) return /*#__PURE__*/_jsxDEV(LoadingContainer, {\n    children: \"Loading Details...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 38\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(PageHeader, {\n      children: \"Account Details\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      onSubmit: handleSubmit,\n      children: /*#__PURE__*/_jsxDEV(SaveButton, {\n        type: \"submit\",\n        disabled: isSaving,\n        children: isSaving ? 'Saving...' : 'Save Account Details'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      onSubmit: handlePasswordSubmit,\n      style: {\n        marginTop: '24px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Fieldset, {\n        children: [/*#__PURE__*/_jsxDEV(\"legend\", {\n          children: \"Password change\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormGroup, {\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            htmlFor: \"newPassword\",\n            children: \"New password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            id: \"newPassword\",\n            name: \"newPassword\",\n            type: \"password\",\n            value: passwordData.newPassword,\n            onChange: handlePasswordChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormGroup, {\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            htmlFor: \"confirmPassword\",\n            children: \"Confirm new password\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            id: \"confirmPassword\",\n            name: \"confirmPassword\",\n            type: \"password\",\n            value: passwordData.confirmPassword,\n            onChange: handlePasswordChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SaveButton, {\n        type: \"submit\",\n        disabled: isSavingPassword,\n        children: isSavingPassword ? 'Saving...' : 'Set New Password'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n};\n_s(AccountDetailsPage, \"RXxlKYWS6hIwV7WFVC+0iMlftPE=\", false, function () {\n  return [useUser];\n});\n_c = AccountDetailsPage;\nexport default AccountDetailsPage;\nvar _c;\n$RefreshReg$(_c, \"AccountDetailsPage\");","map":{"version":3,"names":["React","useState","useEffect","useUser","supabase","jsxDEV","_jsxDEV","AccountDetailsPage","_s","user","formData","setFormData","passwordData","setPasswordData","newPassword","confirmPassword","isLoading","setLoading","isSaving","setSaving","isSavingPassword","setSavingPassword","handleInputChange","e","handlePasswordChange","target","name","value","handleSubmit","handlePasswordSubmit","preventDefault","alert","data","error","functions","invoke","body","method","endpoint","customer_id","id","new_password","err","console","LoadingContainer","children","fileName","_jsxFileName","lineNumber","columnNumber","PageHeader","Form","onSubmit","SaveButton","type","disabled","style","marginTop","Fieldset","FormGroup","Label","htmlFor","Input","onChange","_c","$RefreshReg$"],"sources":["/Users/megamac/Dev/GitHub/projects/certempire-react/src/pages/AccountDetailsPage.tsx"],"sourcesContent":["// src/pages/AccountDetailsPage.tsx\nimport React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useUser } from '../context/UserContext';\nimport { supabase } from '../supabaseClient';\n\n// --- Types ---\ntype FormData = { /* ... as before ... */ };\ntype PasswordFormData = { newPassword: string; confirmPassword: string; };\n\n// --- Styled Components (from your file) ---\n// ... All your styled components remain here ...\n\nconst AccountDetailsPage = () => {\n  const { user } = useUser();\n  const [formData, setFormData] = useState<FormData | null>(null);\n  const [passwordData, setPasswordData] = useState<PasswordFormData>({ newPassword: '', confirmPassword: '' });\n  const [isLoading, setLoading] = useState(true);\n  const [isSaving, setSaving] = useState(false);\n  const [isSavingPassword, setSavingPassword] = useState(false);\n\n  // --- useEffect to fetch data remains the same ---\n  useEffect(() => { /* ... */ }, [user]);\n\n  // --- handleInputChange is now fixed ---\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => { /* ... as fixed in Part 1 ... */ };\n\n  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setPasswordData({ ...passwordData, [e.target.name]: e.target.value });\n  };\n  \n  // --- handleSubmit for main details ---\n  const handleSubmit = async (e: React.FormEvent) => { /* ... */ };\n\n  // --- New handler for password change ---\n  const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n    \n    // 1. Validation Check\n    if (passwordData.newPassword !== passwordData.confirmPassword) {\n      alert(\"Error: New passwords do not match.\");\n      return;\n    }\n    if (!passwordData.newPassword) {\n      alert(\"Error: New password cannot be blank.\");\n      return;\n    }\n\n    setSavingPassword(true);\n    try {\n      const { data, error } = await supabase.functions.invoke('get-wc-data', {\n        body: {\n          method: 'POST',\n          endpoint: 'cwc/customer/set-password',\n          customer_id: user.id,\n          new_password: passwordData.newPassword,\n        },\n      });\n\n      if (error) throw error;\n      alert('Password updated successfully!');\n      setPasswordData({ newPassword: '', confirmPassword: '' }); // Clear fields\n\n    } catch (err) {\n      console.error(\"Error updating password:\", err);\n      alert('Failed to update password.');\n    } finally {\n      setSavingPassword(false);\n    }\n  };\n\n  if (isLoading || !formData) return <LoadingContainer>Loading Details...</LoadingContainer>;\n\n  return (\n    <div>\n      <PageHeader>Account Details</PageHeader>\n      \n      {/* --- Main Details Form --- */}\n      <Form onSubmit={handleSubmit}>\n        {/* ... First Name, Last Name, Billing Address fields ... */}\n        <SaveButton type=\"submit\" disabled={isSaving}>\n          {isSaving ? 'Saving...' : 'Save Account Details'}\n        </SaveButton>\n      </Form>\n\n      {/* --- Password Change Form --- */}\n      <Form onSubmit={handlePasswordSubmit} style={{marginTop: '24px'}}>\n        <Fieldset>\n          <legend>Password change</legend>\n          <FormGroup>\n            <Label htmlFor=\"newPassword\">New password</Label>\n            <Input id=\"newPassword\" name=\"newPassword\" type=\"password\" value={passwordData.newPassword} onChange={handlePasswordChange} />\n          </FormGroup>\n          <FormGroup>\n            <Label htmlFor=\"confirmPassword\">Confirm new password</Label>\n            <Input id=\"confirmPassword\" name=\"confirmPassword\" type=\"password\" value={passwordData.confirmPassword} onChange={handlePasswordChange} />\n          </FormGroup>\n        </Fieldset>\n        <SaveButton type=\"submit\" disabled={isSavingPassword}>\n          {isSavingPassword ? 'Saving...' : 'Set New Password'}\n        </SaveButton>\n      </Form>\n    </div>\n  );\n};\n\nexport default AccountDetailsPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}