{"ast":null,"code":"var _jsxFileName = \"/Users/megamac/Dev/GitHub/projects/certempire-react/src/pages/SimulationPage.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/pages/SimulationPage.tsx\nimport React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { supabase } from '../supabaseClient';\nimport HtmlRenderer from '../components/utils/HtmlRenderer'; // 1. Import the new component\nimport { useDebounce } from 'use-debounce';\nimport { useUser } from '../context/UserContext';\n\n// HELPERS\n\n// --- Helper function ---\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst formatParagraphs = text => {\n  if (!text || typeof text !== 'string') {\n    return \"\";\n  }\n\n  // Regex to find URLs (http, https, or www domains)\n  const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n  return text.split('\\n').filter(line => line.trim() !== '').map(line => {\n    // Find and replace URLs within the line with <a> tags\n    const lineWithLinks = line.replace(urlRegex, url => {\n      // Prepend 'http://' to www links for them to work correctly\n      const href = url.startsWith('www.') ? `http://${url}` : url;\n      // Return the HTML link tag\n      return `<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${url}</a>`;\n    });\n    // Wrap the entire processed line in a <p> tag\n    return `<p>${lineWithLinks}</p>`;\n  }).join('');\n};\n\n// --- Type Definitions ---\n\n// --- SVG Icons ---\nconst IconSearch = () => /*#__PURE__*/_jsxDEV(\"svg\", {\n  width: \"20\",\n  height: \"20\",\n  viewBox: \"0 0 15 15\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159L11.5 12.5L12.5 11.5L10.0158 9.30885C9.42248 9.75587 8.68594 10.0345 7.89932 10.0883L6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5C10 7.50556 9.61334 8.42373 9.00001 9.13098L9.30884 10.0159Z\",\n    fill: \"#757575\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 121\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 53,\n  columnNumber: 26\n}, this);\n_c = IconSearch;\nconst IconDownload = () => /*#__PURE__*/_jsxDEV(\"svg\", {\n  width: \"18\",\n  height: \"18\",\n  viewBox: \"0 0 15 15\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M4 6H2V12.5C2 12.7761 2.22386 13 2.5 13H12.5C12.7761 13 13 12.7761 13 12.5V6H11V12H4V6ZM7.5 10L11 5H8V2H7V5H4L7.5 10Z\",\n    fill: \"currentColor\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 123\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 54,\n  columnNumber: 28\n}, this);\n_c2 = IconDownload;\nconst IconEye = () => /*#__PURE__*/_jsxDEV(\"svg\", {\n  width: \"16\",\n  height: \"16\",\n  viewBox: \"0 0 15 15\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M7.5 11C4.79322 11 2.49241 9.2993 1.05532 7.50001C2.49241 5.70072 4.79322 4 7.5 4C10.2068 4 12.5076 5.70072 13.9447 7.50001C12.5076 9.2993 10.2068 11 7.5 11ZM7.5 3C4.33776 3 1.68988 5.00373 0.160645 6.88398L0.116041 6.94165C-0.0386803 7.14378 -0.0386803 7.85624 0.116041 8.05837L0.160645 8.11604C1.68988 9.99629 4.33776 12 7.5 12C10.6622 12 13.3101 9.99629 14.8394 8.11604L14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398C13.3101 5.00373 10.6622 3 7.5 3ZM7.5 9C6.40237 9 5.50655 8.11289 5.5 7.00001C5.50655 5.88713 6.40237 5.00001 7.5 5.00001C8.59763 5.00001 9.49345 5.88713 9.5 7.00001C9.49345 8.11289 8.59763 9 7.5 9Z\",\n    fill: \"currentColor\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 118\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 55,\n  columnNumber: 23\n}, this);\n_c3 = IconEye;\nconst IconEyeSlash = () => /*#__PURE__*/_jsxDEV(\"svg\", {\n  width: \"16\",\n  height: \"16\",\n  viewBox: \"0 0 15 15\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M1.3415 13.6585L13.6582 1.34176L12.9511 0.634691L0.634433 12.9514L1.3415 13.6585ZM4.39893 9.60107C3.13626 8.87784 2.15372 7.84628 1.05532 7.5C2.49241 5.70072 4.79322 4 7.5 4C8.61439 4 9.66427 4.29891 10.584 4.80878L9.49989 6.00001C9.49561 5.92548 9.24345 5.88713 9.5 7C9.49345 8.11289 8.59763 9 7.5 9C6.81406 9 6.20237 8.68594 5.86902 8.13098L4.39893 9.60107ZM14.8394 6.88398C13.5936 5.25338 11.6622 3 7.5 3C6.59763 3 5.75655 3.20237 5.00001 3.55837L6.50001 5C6.40237 5 5.50655 5.88713 5.5 7C5.50655 7.24345 5.57452 7.46548 5.68988 7.68988L7.584 9.584C8.75655 9.42548 9.49345 8.49345 9.5 7.41594L13.8839 12.8394C14.4934 12.1129 14.8394 11.2434 14.8394 10.5C14.8394 9.99629 13.3101 8.11604 14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398Z\",\n    fill: \"currentColor\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 123\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 56,\n  columnNumber: 28\n}, this);\n_c4 = IconEyeSlash;\nconst IconTopicFolder = ({\n  style = {}\n}) => /*#__PURE__*/_jsxDEV(\"svg\", {\n  style: style,\n  width: \"28\",\n  height: \"28\",\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M3 5C3 4.44772 3.44772 4 4 4H9.17157C9.58052 4 9.91096 4.24065 10.0607 4.58579L10.5858 5.75736C10.7355 6.1025 11.0659 6.34315 11.4749 6.34315H20C20.5523 6.34315 21 6.79086 21 7.34315V18C21 18.5523 20.5523 19 20 19H4C3.44772 19 3 18.5523 3 18V5Z\",\n    fill: \"#000000\",\n    fillOpacity: \"0.7\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 181\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 57,\n  columnNumber: 72\n}, this);\n_c5 = IconTopicFolder;\nconst IconCaseStudy = () => /*#__PURE__*/_jsxDEV(\"svg\", {\n  width: \"24\",\n  height: \"24\",\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M4 4H20V20H4V4ZM3 3V21H21V3H3ZM6 6H18V8H6V6ZM6 10H18V12H6V10ZM6 14H14V16H6V14Z\",\n    fill: \"#673AB7\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 124\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 58,\n  columnNumber: 29\n}, this);\n_c6 = IconCaseStudy;\nconst IconArrowBack = ({\n  style = {}\n}) => /*#__PURE__*/_jsxDEV(\"svg\", {\n  style: style,\n  width: \"20\",\n  height: \"20\",\n  viewBox: \"0 0 15 15\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M6.85355 3.14645C7.04882 3.34171 7.04882 3.65829 6.85355 3.85355L3.70711 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H3.70711L6.85355 11.1464C7.04882 11.3417 7.04882 11.6583 6.85355 11.8536C6.65829 12.0488 6.34171 12.0488 6.14645 11.8536L1.64645 7.35355C1.45118 7.15829 1.45118 6.84171 1.64645 6.64645L6.14645 2.14645C6.34171 1.95118 6.65829 1.95118 6.85355 2.14645Z\",\n    fill: \"currentColor\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 179\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 59,\n  columnNumber: 70\n}, this);\n_c7 = IconArrowBack;\nconst IconArrowForward = ({\n  style = {}\n}) => /*#__PURE__*/_jsxDEV(\"svg\", {\n  style: style,\n  width: \"20\",\n  height: \"20\",\n  viewBox: \"0 0 15 15\",\n  fill: \"none\",\n  xmlns: \"http://www.w3.org/2000/svg\",\n  children: /*#__PURE__*/_jsxDEV(\"path\", {\n    d: \"M8.14645 3.14645C8.34171 3.34171 8.34171 3.65829 8.14645 3.85355L4.99999 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H5L8.14645 11.1464C8.34171 11.3417 8.34171 11.6583 8.14645 11.8536C7.95118 12.0488 7.6346 12.0488 7.43934 11.8536L2.93934 7.35355C2.74408 7.15829 2.74408 6.84171 2.93934 6.64645L7.43934 2.14645C7.6346 1.95118 7.95118 1.95118 8.14645 2.14645Z\",\n    fill: \"currentColor\",\n    transform: \"scale(-1,1) translate(-15,0)\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 182\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 60,\n  columnNumber: 73\n}, this);\n\n// --- Helper function ---\n_c8 = IconArrowForward;\nconst flattenItems = topics => {\n  const flatList = [];\n  Object.entries(topics).forEach(([topicKey, topic]) => {\n    if (topic.topic_name) {\n      flatList.push({\n        type: 'topic',\n        content: {\n          title: topic.topic_name,\n          caseStudyCount: topic.case_study ? 1 : 0\n        }\n      });\n    }\n    if (topic.case_study) {\n      var _topic$questions;\n      flatList.push({\n        type: 'case_study',\n        content: {\n          title: topic.topic_name || topicKey,\n          description: topic.case_study,\n          questionsCount: ((_topic$questions = topic.questions) === null || _topic$questions === void 0 ? void 0 : _topic$questions.length) || 0\n        }\n      });\n    }\n    (topic.questions || []).forEach((q, qIndex) => {\n      flatList.push({\n        type: 'question',\n        content: {\n          ...q,\n          question_number: q.question_number || (qIndex + 1).toString()\n        }\n      });\n    });\n  });\n  return flatList;\n};\n\n// --- Styled Components (Full Definitions) ---\nconst PageContainer = styled.div` display: flex; flex-direction: column; gap: 16px; `;\n_c9 = PageContainer;\nconst HeaderContainer = styled.div`\n  @media (min-width: 651px) { display: flex; flex-direction: row; align-items: center; justify-content: space-between; gap: 16px; }\n  @media (max-width: 650px) { display: flex; flex-direction: column; gap: 16px; }\n`;\n_c0 = HeaderContainer;\nconst FileName = styled.h2` color: #2c2c54; font-weight: bold; font-size: 22px; `;\n_c1 = FileName;\nconst HeaderActions = styled.div` display: flex; align-items: center; gap: 12px; `;\n_c10 = HeaderActions;\nconst DownloadButtonText = styled.span`\n  display: inline;\n  @media (max-width: 650px) {\n    display: none;\n  }\n`;\n_c11 = DownloadButtonText;\nconst ViewToggle = styled.div`\n  display: flex; align-items: center; gap: 4px; padding: 4px 8px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px;\n  span { font-weight: bold; color: #757575; }\n  svg { color: #757575; }\n`;\n_c12 = ViewToggle;\nconst Switch = styled.input.attrs({\n  type: 'checkbox'\n})`\n  appearance: none; width: 34px; height: 20px; background: #E0E0E0; border-radius: 10px; position: relative; cursor: pointer;\n  &:checked { background: #673AB7; }\n  &::before { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: 0.2s; }\n  &:checked::before { left: 16px; }\n`;\n_c13 = Switch;\nconst GoToButton = styled.button`\n  background: none; border: 1px solid #E0E0E0; padding: 8px 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; color: #757575;\n`;\n_c14 = GoToButton;\nconst DownloadButton = styled.button`\n  background-color: #673AB7; color: white; border: none; border-radius: 12px; padding: 10px 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px;\n @media (max-width: 650px) {\n    padding: 12px;\n    border-radius: 50%;\n  }\n`;\n_c15 = DownloadButton;\nconst GoToFieldContainer = styled.div`\n  height: ${({\n  $show\n}) => $show ? '60px' : '0'}; display: flex; justify-content: center; align-items: center; gap: 8px; overflow: hidden; transition: height 0.3s;\n`;\n_c16 = GoToFieldContainer;\nconst GoToInput = styled.input` width: 150px; text-align: center; border: 1px solid #E0E0E0; border-radius: 8px; padding: 8px; `;\n_c17 = GoToInput;\nconst GoButton = styled.button` background-color: #673AB7; color: white; border: none; padding: 8px 16px; border-radius: 8px; `;\n_c18 = GoButton;\nconst ContentContainer = styled.div` background-color: white; border-radius: 12px; border: 1px solid #E0E0E0; `;\n_c19 = ContentContainer;\nconst TopicHeader = styled.div` padding: 24px 16px 16px; display: flex; align-items: center; gap: 16px; font-size: 20px; font-weight: bold; color: #424242; span { font-weight: 500; } `;\n_c20 = TopicHeader;\nconst CaseStudyContainer = styled.div` background-color: rgba(239, 234, 254, 0.4); border-bottom: 1px solid rgba(103, 58, 183, 0.2); padding: 26px; `;\n_c21 = CaseStudyContainer;\nconst CaseStudyHeader = styled.div` display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: bold; color: #673AB7; @media (max-width: 500px) { flex-direction: column; align-items: flex-start; } `;\n_c22 = CaseStudyHeader;\nconst CaseStudyLabel = styled.p` color: #BDBDBD; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; `;\n_c23 = CaseStudyLabel;\nconst CaseStudyQuestions = styled.span` font-size: 14px; font-weight: 500; color: #757575; `;\n_c24 = CaseStudyQuestions;\nconst CaseStudyToggle = styled.button` background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;\n_c25 = CaseStudyToggle;\nconst CaseStudyContent = styled.div`\n  max-height: ${({\n  $expanded\n}) => $expanded ? 'none' : '50px'}; overflow: hidden; transition: max-height 0.3s; \n`;\n_c26 = CaseStudyContent;\nconst HideButtonBottom = styled.button` position: absolute; bottom: 10px; right: 10px; background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;\n_c27 = HideButtonBottom;\nconst QuestionCardContainer = styled.div` padding: 26px; `;\n_c28 = QuestionCardContainer;\nconst QuestionHeader = styled.div` @media (min-width: 601px) { display: flex; align-items: flex-start; gap: 18px; } @media (max-width: 600px) { display: flex; flex-direction: column; gap: 16px; } `;\n_c29 = QuestionHeader;\nconst QuestionNumber = styled.div` background-color: rgba(103, 58, 183, 0.12); color: #673AB7; font-weight: bold; font-size: 16px; padding: 12px; border-radius: 10px; `;\n_c30 = QuestionNumber;\nconst Label = styled.p` color:rgb(131, 129, 131); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; margin-top: 20px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `;\n_c31 = Label;\nconst OptionsList = styled.div` display: flex; flex-direction: column; gap: 11px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `;\n// This is the only change you need\n_c32 = OptionsList;\nconst OptionItem = styled.div`\n  display: flex;\n align-items: baseline;\n  gap: 8px;\n  border: 1px solid ${({\n  $isCorrect\n}) => $isCorrect ? '#38b000' : '#E0E0E0'};\n  background: ${({\n  $isCorrect\n}) => $isCorrect ? '#F4FBF6' : 'transparent'};\n  border-radius: 8px;\n  padding: 11px 14px;\n  font-size: 15px;\n  line-height: 1.35;\n  transition: all 0.14s;\n  box-shadow: ${({\n  $isCorrect\n}) => $isCorrect ? '0 2px 6px rgba(56,176,0,0.1)' : 'none'};\n`;\n_c33 = OptionItem;\nconst ActionButtons = styled.div` display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 8px; margin-top: 26px; `;\n_c34 = ActionButtons;\nconst PrimaryButton = styled.button` border: none; background-color: #673AB7; color: white; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; `;\n_c35 = PrimaryButton;\nconst CorrectAnswerSection = styled.div` display: flex; align-items: center; gap: 8px; padding: 12px 0; @media (max-width: 600px) { flex-direction: column; align-items: flex-start; gap: 16px; } `;\n_c36 = CorrectAnswerSection;\nconst CorrectLabel = styled.span`\n  display: block; /* ✅ Stacks the elements vertically */\n  color:rgb(0, 0, 0);\n  font-weight: 600;\n  font-size: 13px;\n  margin-bottom: 5px;\n`;\n_c37 = CorrectLabel;\nconst CorrectText = styled.span`\n  font-weight: regular;\n  font-size: 15px;\n`;\n_c38 = CorrectText;\nconst ExplanationSection = styled.div` margin-top: 8px; `;\n_c39 = ExplanationSection;\nconst PaginationContainer = styled.div` display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px; `;\n_c40 = PaginationContainer;\nconst PageButton = styled.button` background: none; border: 1px solid #E0E0E0; color: #333; padding: 8px 16px; border-radius: 8px; cursor: pointer; &:disabled { cursor: not-allowed; opacity: 0.5; } `;\n_c41 = PageButton;\nconst LoadingContainer = styled.div` display: flex; justify-content: center; align-items: center; height: 300px; font-size: 18px; color: #757575;`;\n_c42 = LoadingContainer;\nconst PaginationText = styled.span` color: #757575; font-weight: 500; `;\n\n// --- The Main Page Component ---\n\n// STATE HOOKS\n_c43 = PaginationText;\nconst SimulationPage = () => {\n  _s();\n  var _location$state, _currentItem$parent, _currentItem$parent2, _currentItem$parent3, _currentItem$parent$c;\n  const {\n    fileId\n  } = useParams();\n  const [simulationData, setSimulationData] = useState(null);\n  const [structuredItems, setStructuredItems] = useState([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isLoading, setLoading] = useState(true);\n  const [showAnswer, setShowAnswer] = useState(false);\n  const [isSingleView, setIsSingleView] = useState(true);\n  const [showGoToField, setShowGoToField] = useState(false);\n  const [goToInput, setGoToInput] = useState('');\n  const [showAnswersMap, setShowAnswersMap] = useState({});\n  const {\n    user\n  } = useUser();\n  const location = useLocation();\n  const [multiViewPage, setMultiViewPage] = useState(1);\n  const startIndex = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.startIndex;\n  const [debouncedIndex] = useDebounce(currentIndex, 1500); // Saves 1.5s after user stops\n  const [alertInfo, setAlertInfo] = useState({\n    isOpen: false,\n    message: \"\",\n    href: null\n  });\n  const [downloadUrl, setDownloadUrl] = useState(null);\n  const handleReferenceLinkClick = href => {\n    setAlertInfo({\n      isOpen: true,\n      href: href,\n      // Store the link to open\n      message: \"You are accessing a reference link. Before you move out, please remember that platforms keep changing their URLs for such documents, and by the time you click it, it might have changed. In case the link is broken or returns a \\\"Not Found,\\\" error, the best way is to search the reference doc online. Thank you.\"\n    });\n  };\n  const handleAlertConfirm = () => {\n    // This function runs when \"OK\" is clicked.\n    if (alertInfo.href) {\n      // This method is more likely to open a new tab instead of a new window.\n      const link = document.createElement('a');\n      link.href = alertInfo.href;\n      link.target = '_blank';\n      link.rel = 'noopener noreferrer';\n      link.click();\n    }\n    // Close the modal\n    setAlertInfo({\n      isOpen: false,\n      message: \"\",\n      href: null\n    });\n  };\n  useEffect(() => {\n    if (!fileId) return;\n    async function getSimulationData() {\n      var _data$aiParsedData, _data$aiParsedData$re;\n      setLoading(true);\n      const {\n        data,\n        error\n      } = await supabase.from('files').select('filename, ai-parsed-data').eq('id', fileId).single();\n      if (error) {\n        console.error(\"Error fetching file:\", error);\n      } else if (data && (_data$aiParsedData = data['ai-parsed-data']) !== null && _data$aiParsedData !== void 0 && (_data$aiParsedData$re = _data$aiParsedData.result) !== null && _data$aiParsedData$re !== void 0 && _data$aiParsedData$re.topics) {\n        const topics = data['ai-parsed-data'].result.topics;\n        setSimulationData({\n          fileName: data.filename,\n          topics: topics\n        });\n        const newStructuredItems = [];\n        let globalQNum = 1;\n        Object.values(topics).forEach(topic => {\n          (topic.questions || []).forEach(q => {\n            var _topic$questions2;\n            newStructuredItems.push({\n              type: 'question',\n              content: {\n                ...q,\n                question_number: (globalQNum++).toString()\n              },\n              parent: {\n                topic: topic.topic_name,\n                caseStudyTitle: topic.case_study ? topic.topic_name : undefined,\n                caseStudyDescription: topic.case_study ? topic.case_study : undefined,\n                caseStudyQuestionsCount: topic.case_study ? ((_topic$questions2 = topic.questions) === null || _topic$questions2 === void 0 ? void 0 : _topic$questions2.length) || 0 : 0\n              }\n            });\n          });\n        });\n        setStructuredItems(newStructuredItems);\n        if (startIndex && startIndex > 0 && startIndex < newStructuredItems.length) {\n          setCurrentIndex(startIndex);\n        }\n      }\n      setLoading(false);\n    }\n    getSimulationData();\n  }, [fileId, startIndex]);\n  useEffect(() => {\n    setShowAnswer(false);\n  }, [currentIndex]);\n\n  // --- This entire block is new ---\n  useEffect(() => {\n    const saveProgress = async () => {\n      // Use the user object directly from your context\n      if (!user || !fileId || !simulationData || structuredItems.length === 0) {\n        return;\n      }\n      const {\n        error\n      } = await supabase.from('user_progress').upsert({\n        // This now sends the correct numeric WordPress ID\n        user_id: user.id,\n        last_viewed_file_id: fileId,\n        product_name: simulationData.fileName,\n        last_viewed_question_index: debouncedIndex,\n        total_questions: structuredItems.length,\n        updated_at: new Date().toISOString()\n      });\n      if (error) {\n        console.error(\"Supabase error saving progress:\", error);\n      }\n    };\n\n    // Only save if the user has actually navigated to a question\n    saveProgress();\n  }, [debouncedIndex, user, fileId, simulationData, structuredItems.length]); // Dependencies\n\n  useEffect(() => {\n    if (!user || !fileId) return;\n    const getDownloadLink = async () => {\n      try {\n        const {\n          data: apiResponse,\n          error\n        } = await supabase.functions.invoke('get-wc-data', {\n          body: {\n            method: 'GET',\n            endpoint: 'cwc/downloads',\n            user_id: user.id\n          }\n        });\n        if (error) throw error;\n        if (apiResponse && apiResponse.Success && Array.isArray(apiResponse.Data)) {\n          // Find the download that corresponds to the current simulation file\n          const matchingDownload = apiResponse.Data.find(d => d.supabase_file_id === fileId);\n          if (matchingDownload) {\n            setDownloadUrl(matchingDownload.download_url);\n          }\n        }\n      } catch (err) {\n        console.error(\"Error fetching download link for simulation:\", err);\n      }\n    };\n    getDownloadLink();\n  }, [user, fileId]); // Dependencies\n\n  useEffect(() => {\n    setCurrentIndex(0);\n    setShowAnswersMap({});\n    setShowAnswer(false);\n    setMultiViewPage(1);\n  }, [isSingleView]);\n  const handleNext = () => setCurrentIndex(prev => Math.min(prev + 1, structuredItems.length - 1));\n  const handlePrev = () => setCurrentIndex(prev => Math.max(prev - 1, 0));\n  const currentItem = structuredItems[currentIndex];\n  if (isLoading) return /*#__PURE__*/_jsxDEV(LoadingContainer, {\n    children: \"Loading Simulation...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 326,\n    columnNumber: 25\n  }, this);\n  if (!currentItem) return /*#__PURE__*/_jsxDEV(LoadingContainer, {\n    children: \"Could not load questions for this file.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 327,\n    columnNumber: 28\n  }, this);\n\n  // ✅ CALCULATE PAGINATION FOR MULTI-VIEW\n  const itemsPerPage = 25;\n  const allMultiViewItems = flattenItems((simulationData === null || simulationData === void 0 ? void 0 : simulationData.topics) || {});\n  const totalMultiViewPages = Math.ceil(allMultiViewItems.length / itemsPerPage);\n  // Get the 25 items for the current page\n  const paginatedMultiViewItems = allMultiViewItems.slice((multiViewPage - 1) * itemsPerPage, multiViewPage * itemsPerPage);\n  return /*#__PURE__*/_jsxDEV(PageContainer, {\n    children: [/*#__PURE__*/_jsxDEV(HeaderContainer, {\n      children: [/*#__PURE__*/_jsxDEV(FileName, {\n        title: simulationData === null || simulationData === void 0 ? void 0 : simulationData.fileName,\n        children: simulationData === null || simulationData === void 0 ? void 0 : simulationData.fileName\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(HeaderActions, {\n        children: [/*#__PURE__*/_jsxDEV(ViewToggle, {\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"View:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(IconTopicFolder, {\n            style: {\n              color: !isSingleView ? '#673AB7' : '#757575',\n              width: 20,\n              height: 20\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Switch, {\n            checked: isSingleView,\n            onChange: e => setIsSingleView(e.target.checked)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 347,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n            width: \"20\",\n            height: \"20\",\n            viewBox: \"0 0 24 24\",\n            fill: \"none\",\n            xmlns: \"http://www.w3.org/2000/svg\",\n            style: {\n              color: isSingleView ? '#673AB7' : '#757575'\n            },\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M4 6H20V8H4V6ZM4 11H20V13H4V11ZM4 16H20V18H4V16Z\",\n              fill: \"currentColor\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 164\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(GoToButton, {\n          onClick: () => setShowGoToField(!showGoToField),\n          children: [/*#__PURE__*/_jsxDEV(IconSearch, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 13\n          }, this), \" Go To\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(DownloadButton, {\n          onClick: () => window.open(downloadUrl, '_blank'),\n          disabled: !downloadUrl,\n          title: !downloadUrl ? \"Download link not available\" : \"Download file\",\n          children: [/*#__PURE__*/_jsxDEV(IconDownload, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(DownloadButtonText, {\n            children: \"Download\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(GoToFieldContainer, {\n      $show: showGoToField,\n      children: [/*#__PURE__*/_jsxDEV(GoToInput, {\n        type: \"number\",\n        value: goToInput,\n        onChange: e => setGoToInput(e.target.value),\n        placeholder: \"Go to...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(GoButton, {\n        onClick: () => {\n          const target = parseInt(goToInput);\n          if (target >= 1 && target <= structuredItems.length) {\n            setCurrentIndex(target - 1);\n            setIsSingleView(true);\n            setShowGoToField(false);\n            setGoToInput('');\n          } else {\n            alert(`Enter a number between 1 and ${structuredItems.length}`);\n          }\n        },\n        children: \"Go\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ContentContainer, {\n      children: isSingleView ?\n      /*#__PURE__*/\n      // --- Single View (no changes here) ---\n      _jsxDEV(_Fragment, {\n        children: [((_currentItem$parent = currentItem.parent) === null || _currentItem$parent === void 0 ? void 0 : _currentItem$parent.topic) && /*#__PURE__*/_jsxDEV(TopicHeader, {\n          children: [/*#__PURE__*/_jsxDEV(IconTopicFolder, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 385,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"Topic: \"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 387,\n              columnNumber: 19\n            }, this), currentItem.parent.topic, ((_currentItem$parent2 = currentItem.parent) === null || _currentItem$parent2 === void 0 ? void 0 : _currentItem$parent2.caseStudyDescription) && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: 14,\n                color: '#757575'\n              },\n              children: \"Case Studies: 1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 64\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 15\n        }, this), ((_currentItem$parent3 = currentItem.parent) === null || _currentItem$parent3 === void 0 ? void 0 : _currentItem$parent3.caseStudyTitle) && /*#__PURE__*/_jsxDEV(RenderCaseStudy, {\n          caseStudy: {\n            title: currentItem.parent.caseStudyTitle || 'Case Study',\n            description: currentItem.parent.caseStudyDescription || '',\n            questionsCount: (_currentItem$parent$c = currentItem.parent.caseStudyQuestionsCount) !== null && _currentItem$parent$c !== void 0 ? _currentItem$parent$c : 0\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 52\n        }, this), /*#__PURE__*/_jsxDEV(RenderQuestion, {\n          question: currentItem.content,\n          showAnswer: showAnswer,\n          setShowAnswer: setShowAnswer,\n          onLinkClick: handleReferenceLinkClick\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) :\n      /*#__PURE__*/\n      // --- ✅ MODIFIED MULTI-VIEW WITH PAGINATION ---\n      _jsxDEV(_Fragment, {\n        children: [paginatedMultiViewItems.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [item.type === 'topic' && /*#__PURE__*/_jsxDEV(TopicHeader, {\n            children: [/*#__PURE__*/_jsxDEV(IconTopicFolder, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Topic: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 410,\n                columnNumber: 23\n              }, this), item.content.title, item.content.caseStudyCount > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: 14,\n                  color: '#757575'\n                },\n                children: [\"Case Studies: \", item.content.caseStudyCount]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 411,\n                columnNumber: 59\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 409,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 19\n          }, this), item.type === 'case_study' && /*#__PURE__*/_jsxDEV(RenderCaseStudy, {\n            caseStudy: item.content\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 48\n          }, this), item.type === 'question' && /*#__PURE__*/_jsxDEV(RenderQuestion, {\n            question: item.content,\n            showAnswer: showAnswersMap[item.content.question_number] || false,\n            setShowAnswer: newVal => setShowAnswersMap(prev => ({\n              ...prev,\n              [item.content.question_number]: newVal\n            })),\n            onLinkClick: handleReferenceLinkClick\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 19\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 15\n        }, this)), totalMultiViewPages > 1 && /*#__PURE__*/_jsxDEV(PaginationContainer, {\n          children: [/*#__PURE__*/_jsxDEV(PaginationText, {\n            children: [\"Page \", multiViewPage, \" of \", totalMultiViewPages]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              gap: '8px'\n            },\n            children: [/*#__PURE__*/_jsxDEV(PageButton, {\n              onClick: () => setMultiViewPage(p => Math.max(1, p - 1)),\n              disabled: multiViewPage === 1,\n              children: /*#__PURE__*/_jsxDEV(IconArrowBack, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 432,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 431,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(PageButton, {\n              onClick: () => setMultiViewPage(p => Math.min(totalMultiViewPages, p + 1)),\n              disabled: multiViewPage === totalMultiViewPages,\n              children: /*#__PURE__*/_jsxDEV(IconArrowForward, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 435,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 434,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(PaginationContainer, {\n      children: [/*#__PURE__*/_jsxDEV(PaginationText, {\n        children: [\"Question \", isSingleView ? currentItem.content.question_number : 'Page View', \" of \", structuredItems.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 445,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: '8px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(PageButton, {\n          onClick: handlePrev,\n          disabled: currentIndex === 0,\n          style: {\n            color: currentIndex === 0 ? '#757575' : '#673AB7'\n          },\n          children: /*#__PURE__*/_jsxDEV(IconArrowBack, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 447,\n            columnNumber: 136\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(PageButton, {\n          onClick: handleNext,\n          disabled: currentIndex === structuredItems.length - 1,\n          style: {\n            color: currentIndex === structuredItems.length - 1 ? '#757575' : '#673AB7'\n          },\n          children: /*#__PURE__*/_jsxDEV(IconArrowForward, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 186\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 444,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(AlertModal, {\n      isOpen: alertInfo.isOpen,\n      message: alertInfo.message,\n      onConfirm: handleAlertConfirm\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 451,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 340,\n    columnNumber: 5\n  }, this);\n};\n_s(SimulationPage, \"DUoMvtdrvYwAyoHOvtoyZ+VdBC0=\", false, function () {\n  return [useParams, useUser, useLocation, useDebounce];\n});\n_c44 = SimulationPage;\nconst RenderCaseStudy = ({\n  caseStudy\n}) => {\n  _s2();\n  const [expanded, setExpanded] = useState(false);\n  return /*#__PURE__*/_jsxDEV(CaseStudyContainer, {\n    children: [/*#__PURE__*/_jsxDEV(CaseStudyHeader, {\n      children: [/*#__PURE__*/_jsxDEV(IconCaseStudy, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 465,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1\n        },\n        children: [/*#__PURE__*/_jsxDEV(CaseStudyLabel, {\n          children: \"Case Study\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 11\n        }, this), caseStudy.title]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CaseStudyQuestions, {\n        children: [\"Questions: \", caseStudy.questionsCount]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CaseStudyToggle, {\n        onClick: () => setExpanded(!expanded),\n        children: [expanded ? 'Hide' : 'Show', \" \", expanded ? /*#__PURE__*/_jsxDEV(IconArrowBack, {\n          style: {\n            transform: 'rotate(90deg)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 52\n        }, this) : /*#__PURE__*/_jsxDEV(IconArrowForward, {\n          style: {\n            transform: 'rotate(90deg)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 111\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'relative'\n      },\n      children: [/*#__PURE__*/_jsxDEV(CaseStudyContent, {\n        $expanded: expanded,\n        children: /*#__PURE__*/_jsxDEV(HtmlRenderer, {\n          htmlString: caseStudy.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 9\n      }, this), expanded && /*#__PURE__*/_jsxDEV(HideButtonBottom, {\n        onClick: () => setExpanded(false),\n        children: [\"Hide \", /*#__PURE__*/_jsxDEV(IconArrowBack, {\n          style: {\n            transform: 'rotate(90deg)'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 18\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 475,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 463,\n    columnNumber: 5\n  }, this);\n};\n_s2(RenderCaseStudy, \"DuL5jiiQQFgbn7gBKAyxwS/H4Ek=\");\n_c45 = RenderCaseStudy;\nconst AlertModal = ({\n  isOpen,\n  message,\n  onConfirm // 👈 Change onClose to onConfirm\n}) => {\n  if (!isOpen) return null;\n  const modalStyle = {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: 'rgba(0, 0, 0, 0.6)',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    zIndex: 1000\n  };\n  const contentStyle = {\n    backgroundColor: 'white',\n    padding: '30px',\n    borderRadius: '12px',\n    maxWidth: '500px',\n    boxShadow: '0 5px 15px rgba(0,0,0,0.3)',\n    textAlign: 'center',\n    lineHeight: 1.6\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: modalStyle,\n    onClick: onConfirm,\n    children: [\" \", /*#__PURE__*/_jsxDEV(\"div\", {\n      style: contentStyle,\n      onClick: e => e.stopPropagation(),\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 527,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onConfirm // 👈 Use onConfirm here\n        ,\n        style: {\n          marginTop: '20px',\n          padding: '10px 24px',\n          border: 'none',\n          backgroundColor: '#673AB7',\n          color: 'white',\n          borderRadius: '8px',\n          cursor: 'pointer',\n          fontWeight: 600\n        },\n        children: \"OK\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 528,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 526,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 525,\n    columnNumber: 5\n  }, this);\n};\n_c46 = AlertModal;\nconst RenderQuestion = ({\n  question,\n  showAnswer,\n  setShowAnswer,\n  onLinkClick\n}) => {\n  var _ref, _question$references;\n  const handleLinkClick = e => {\n    const target = e.target;\n    if (target.tagName === 'A') {\n      e.preventDefault(); // Still prevent the default to call our custom handler\n      const href = target.getAttribute('href');\n      if (href) {\n        onLinkClick(href); // 👈 Use the prop to call the function in the parent\n      }\n    }\n  };\n\n  // Defensive extraction with fallback\n  const answerArray = Array.isArray(question.answer) ? question.answer : typeof question.answer === \"string\" && question.answer.length ? [question.answer] : [];\n  const optionsArray = Array.isArray(question.options) ? question.options : typeof question.options === \"string\" && question.options.length ? [question.options] : [];\n\n  // Correct answer display string\n  const correctLetters = answerArray.join(\", \");\n\n  // Extra fields (handle snake_case and camelCase)\n  const explanation = typeof question.explanation === \"string\" ? question.explanation : \"\";\n  const whyIncorrect = typeof question.why_incorrect === \"string\" ? question.why_incorrect : typeof question.whyIncorrect === \"string\" ? question.whyIncorrect : \"\";\n  // References may be array or string\n  let references = (_ref = (_question$references = question.references) !== null && _question$references !== void 0 ? _question$references : question.References) !== null && _ref !== void 0 ? _ref : \"\";\n  if (Array.isArray(references)) references = references.join(\"\\n\");\n  references = typeof references === \"string\" ? references : \"\";\n\n  // \"Has\" checkers\n  const hasExplanation = explanation.trim() !== \"\";\n  const hasWhyIncorrect = whyIncorrect.trim() !== \"\";\n  const hasReferences = references.trim() !== \"\";\n  return /*#__PURE__*/_jsxDEV(QuestionCardContainer, {\n    style: {\n      background: showAnswer ? \"linear-gradient(to bottom, rgba(239,234,254,0.15) 60%, white)\" : \"white\",\n      borderRadius: 18,\n      boxShadow: \"0 5px 15px rgba(103,58,183,0.04)\",\n      marginBottom: 24\n    },\n    children: [/*#__PURE__*/_jsxDEV(QuestionHeader, {\n      children: [/*#__PURE__*/_jsxDEV(QuestionNumber, {\n        children: [\"Q: \", question.question_number || question.id || \"\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 621,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1\n        },\n        children: /*#__PURE__*/_jsxDEV(HtmlRenderer, {\n          htmlString: typeof question.question === \"string\" ? question.question : \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 623,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 622,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 620,\n      columnNumber: 7\n    }, this), optionsArray.length > 0 && /*#__PURE__*/_jsxDEV(Label, {\n      children: \"Options\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 627,\n      columnNumber: 35\n    }, this), /*#__PURE__*/_jsxDEV(OptionsList, {\n      children: optionsArray.map((opt, index) => {\n        const letter = String.fromCharCode(65 + index);\n        // Prepare all possible representations of the answer\n        const answerSet = new Set(answerArray.flatMap(a => a.split(/,\\s*/)) // Splits \"A, C\" into [\"A\", \"C\"]\n        .map(a => a.trim().toUpperCase())); // Compare by letter (\"A\", \"B\", etc)\n        const letterIsCorrect = answerSet.has(letter.toUpperCase());\n        // Compare by text (full option value, stripped and uppercased)\n        const valueIsCorrect = answerSet.has(opt.trim().toUpperCase()) || answerSet.has(opt.trim());\n        // Highlight if either matches\n        const isCorrect = showAnswer && (letterIsCorrect || valueIsCorrect);\n        return /*#__PURE__*/_jsxDEV(OptionItem, {\n          $isCorrect: isCorrect,\n          children: [/*#__PURE__*/_jsxDEV(\"b\", {\n            children: [letter, \": \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 647,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              display: \"inline\"\n            },\n            children: /*#__PURE__*/_jsxDEV(HtmlRenderer, {\n              htmlString: typeof opt === \"string\" ? opt.replace(/^[A-Z][.)]\\s*/, \"\") : \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 649,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 648,\n            columnNumber: 15\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 646,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 628,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ActionButtons, {\n      children: /*#__PURE__*/_jsxDEV(PrimaryButton, {\n        onClick: () => setShowAnswer(!showAnswer),\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [showAnswer ? /*#__PURE__*/_jsxDEV(IconEyeSlash, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 659,\n            columnNumber: 27\n          }, this) : /*#__PURE__*/_jsxDEV(IconEye, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 659,\n            columnNumber: 46\n          }, this), \" \", showAnswer ? \"Hide Answer\" : \"Show Answer\"]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 657,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 656,\n      columnNumber: 7\n    }, this), showAnswer && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          borderTop: \"1.1px solid #E0E0E0\",\n          margin: \"32px 0\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 667,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(CorrectAnswerSection, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(CorrectLabel, {\n            children: \"Correct Answer:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 670,\n            columnNumber: 15\n          }, this), \" \", /*#__PURE__*/_jsxDEV(CorrectText, {\n            children: correctLetters\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 671,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 669,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 668,\n        columnNumber: 11\n      }, this), hasExplanation && /*#__PURE__*/_jsxDEV(ExplanationSection, {\n        children: [/*#__PURE__*/_jsxDEV(Label, {\n          children: \"Explanation\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 686,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(HtmlRenderer, {\n          htmlString: explanation\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 687,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: \"right\",\n            marginTop: 10\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 688,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 685,\n        columnNumber: 13\n      }, this), hasWhyIncorrect && /*#__PURE__*/_jsxDEV(ExplanationSection, {\n        children: [/*#__PURE__*/_jsxDEV(Label, {\n          children: \"Why Incorrect Options are Wrong\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 696,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(HtmlRenderer, {\n          htmlString: formatParagraphs(whyIncorrect)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 697,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 695,\n        columnNumber: 13\n      }, this), hasReferences &&\n      /*#__PURE__*/\n      // 👇 And attach handler here\n      _jsxDEV(ExplanationSection, {\n        onClick: handleLinkClick,\n        children: [/*#__PURE__*/_jsxDEV(Label, {\n          children: \"References\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 704,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(HtmlRenderer, {\n          htmlString: formatParagraphs(references)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 705,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 703,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 610,\n    columnNumber: 5\n  }, this);\n};\n_c47 = RenderQuestion;\nexport default SimulationPage;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0, _c1, _c10, _c11, _c12, _c13, _c14, _c15, _c16, _c17, _c18, _c19, _c20, _c21, _c22, _c23, _c24, _c25, _c26, _c27, _c28, _c29, _c30, _c31, _c32, _c33, _c34, _c35, _c36, _c37, _c38, _c39, _c40, _c41, _c42, _c43, _c44, _c45, _c46, _c47;\n$RefreshReg$(_c, \"IconSearch\");\n$RefreshReg$(_c2, \"IconDownload\");\n$RefreshReg$(_c3, \"IconEye\");\n$RefreshReg$(_c4, \"IconEyeSlash\");\n$RefreshReg$(_c5, \"IconTopicFolder\");\n$RefreshReg$(_c6, \"IconCaseStudy\");\n$RefreshReg$(_c7, \"IconArrowBack\");\n$RefreshReg$(_c8, \"IconArrowForward\");\n$RefreshReg$(_c9, \"PageContainer\");\n$RefreshReg$(_c0, \"HeaderContainer\");\n$RefreshReg$(_c1, \"FileName\");\n$RefreshReg$(_c10, \"HeaderActions\");\n$RefreshReg$(_c11, \"DownloadButtonText\");\n$RefreshReg$(_c12, \"ViewToggle\");\n$RefreshReg$(_c13, \"Switch\");\n$RefreshReg$(_c14, \"GoToButton\");\n$RefreshReg$(_c15, \"DownloadButton\");\n$RefreshReg$(_c16, \"GoToFieldContainer\");\n$RefreshReg$(_c17, \"GoToInput\");\n$RefreshReg$(_c18, \"GoButton\");\n$RefreshReg$(_c19, \"ContentContainer\");\n$RefreshReg$(_c20, \"TopicHeader\");\n$RefreshReg$(_c21, \"CaseStudyContainer\");\n$RefreshReg$(_c22, \"CaseStudyHeader\");\n$RefreshReg$(_c23, \"CaseStudyLabel\");\n$RefreshReg$(_c24, \"CaseStudyQuestions\");\n$RefreshReg$(_c25, \"CaseStudyToggle\");\n$RefreshReg$(_c26, \"CaseStudyContent\");\n$RefreshReg$(_c27, \"HideButtonBottom\");\n$RefreshReg$(_c28, \"QuestionCardContainer\");\n$RefreshReg$(_c29, \"QuestionHeader\");\n$RefreshReg$(_c30, \"QuestionNumber\");\n$RefreshReg$(_c31, \"Label\");\n$RefreshReg$(_c32, \"OptionsList\");\n$RefreshReg$(_c33, \"OptionItem\");\n$RefreshReg$(_c34, \"ActionButtons\");\n$RefreshReg$(_c35, \"PrimaryButton\");\n$RefreshReg$(_c36, \"CorrectAnswerSection\");\n$RefreshReg$(_c37, \"CorrectLabel\");\n$RefreshReg$(_c38, \"CorrectText\");\n$RefreshReg$(_c39, \"ExplanationSection\");\n$RefreshReg$(_c40, \"PaginationContainer\");\n$RefreshReg$(_c41, \"PageButton\");\n$RefreshReg$(_c42, \"LoadingContainer\");\n$RefreshReg$(_c43, \"PaginationText\");\n$RefreshReg$(_c44, \"SimulationPage\");\n$RefreshReg$(_c45, \"RenderCaseStudy\");\n$RefreshReg$(_c46, \"AlertModal\");\n$RefreshReg$(_c47, \"RenderQuestion\");","map":{"version":3,"names":["React","useState","useEffect","styled","useParams","useLocation","supabase","HtmlRenderer","useDebounce","useUser","jsxDEV","_jsxDEV","Fragment","_Fragment","formatParagraphs","text","urlRegex","split","filter","line","trim","map","lineWithLinks","replace","url","href","startsWith","join","IconSearch","width","height","viewBox","fill","xmlns","children","d","fileName","_jsxFileName","lineNumber","columnNumber","_c","IconDownload","_c2","IconEye","_c3","IconEyeSlash","_c4","IconTopicFolder","style","fillOpacity","_c5","IconCaseStudy","_c6","IconArrowBack","_c7","IconArrowForward","transform","_c8","flattenItems","topics","flatList","Object","entries","forEach","topicKey","topic","topic_name","push","type","content","title","caseStudyCount","case_study","_topic$questions","description","questionsCount","questions","length","q","qIndex","question_number","toString","PageContainer","div","_c9","HeaderContainer","_c0","FileName","h2","_c1","HeaderActions","_c10","DownloadButtonText","span","_c11","ViewToggle","_c12","Switch","input","attrs","_c13","GoToButton","button","_c14","DownloadButton","_c15","GoToFieldContainer","$show","_c16","GoToInput","_c17","GoButton","_c18","ContentContainer","_c19","TopicHeader","_c20","CaseStudyContainer","_c21","CaseStudyHeader","_c22","CaseStudyLabel","p","_c23","CaseStudyQuestions","_c24","CaseStudyToggle","_c25","CaseStudyContent","$expanded","_c26","HideButtonBottom","_c27","QuestionCardContainer","_c28","QuestionHeader","_c29","QuestionNumber","_c30","Label","_c31","OptionsList","_c32","OptionItem","$isCorrect","_c33","ActionButtons","_c34","PrimaryButton","_c35","CorrectAnswerSection","_c36","CorrectLabel","_c37","CorrectText","_c38","ExplanationSection","_c39","PaginationContainer","_c40","PageButton","_c41","LoadingContainer","_c42","PaginationText","_c43","SimulationPage","_s","_location$state","_currentItem$parent","_currentItem$parent2","_currentItem$parent3","_currentItem$parent$c","fileId","simulationData","setSimulationData","structuredItems","setStructuredItems","currentIndex","setCurrentIndex","isLoading","setLoading","showAnswer","setShowAnswer","isSingleView","setIsSingleView","showGoToField","setShowGoToField","goToInput","setGoToInput","showAnswersMap","setShowAnswersMap","user","location","multiViewPage","setMultiViewPage","startIndex","state","debouncedIndex","alertInfo","setAlertInfo","isOpen","message","downloadUrl","setDownloadUrl","handleReferenceLinkClick","handleAlertConfirm","link","document","createElement","target","rel","click","getSimulationData","_data$aiParsedData","_data$aiParsedData$re","data","error","from","select","eq","single","console","result","filename","newStructuredItems","globalQNum","values","_topic$questions2","parent","caseStudyTitle","undefined","caseStudyDescription","caseStudyQuestionsCount","saveProgress","upsert","user_id","id","last_viewed_file_id","product_name","last_viewed_question_index","total_questions","updated_at","Date","toISOString","getDownloadLink","apiResponse","functions","invoke","body","method","endpoint","Success","Array","isArray","Data","matchingDownload","find","supabase_file_id","download_url","err","handleNext","prev","Math","min","handlePrev","max","currentItem","itemsPerPage","allMultiViewItems","totalMultiViewPages","ceil","paginatedMultiViewItems","slice","color","checked","onChange","e","onClick","window","open","disabled","value","placeholder","parseInt","alert","fontSize","RenderCaseStudy","caseStudy","RenderQuestion","question","onLinkClick","item","index","newVal","display","gap","AlertModal","onConfirm","_c44","_s2","expanded","setExpanded","flex","position","htmlString","_c45","modalStyle","top","left","right","bottom","backgroundColor","alignItems","justifyContent","zIndex","contentStyle","padding","borderRadius","maxWidth","boxShadow","textAlign","lineHeight","stopPropagation","marginTop","border","cursor","fontWeight","_c46","_ref","_question$references","handleLinkClick","tagName","preventDefault","getAttribute","answerArray","answer","optionsArray","options","correctLetters","explanation","whyIncorrect","why_incorrect","references","References","hasExplanation","hasWhyIncorrect","hasReferences","background","marginBottom","opt","letter","String","fromCharCode","answerSet","Set","flatMap","a","toUpperCase","letterIsCorrect","has","valueIsCorrect","isCorrect","borderTop","margin","_c47","$RefreshReg$"],"sources":["/Users/megamac/Dev/GitHub/projects/certempire-react/src/pages/SimulationPage.tsx"],"sourcesContent":["// src/pages/SimulationPage.tsx\nimport React, { useState, useEffect, CSSProperties } from 'react';\nimport styled from 'styled-components';\nimport { useParams, useLocation } from 'react-router-dom';\nimport { supabase } from '../supabaseClient';\nimport HtmlRenderer from '../components/utils/HtmlRenderer'; // 1. Import the new component\nimport { useDebounce } from 'use-debounce';\nimport { useUser } from '../context/UserContext';\n\n// HELPERS\n\n// --- Helper function ---\nconst formatParagraphs = (text: string): string => {\n  if (!text || typeof text !== 'string') {\n    return \"\";\n  }\n\n  // Regex to find URLs (http, https, or www domains)\n  const urlRegex = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+)/g;\n\n  return text\n    .split('\\n')\n    .filter(line => line.trim() !== '')\n    .map(line => {\n      // Find and replace URLs within the line with <a> tags\n      const lineWithLinks = line.replace(urlRegex, (url) => {\n        // Prepend 'http://' to www links for them to work correctly\n        const href = url.startsWith('www.') ? `http://${url}` : url;\n        // Return the HTML link tag\n        return `<a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\">${url}</a>`;\n      });\n      // Wrap the entire processed line in a <p> tag\n      return `<p>${lineWithLinks}</p>`;\n    })\n    .join('');\n};\n\n// --- Type Definitions ---\ntype Question = {\n  answer: string[];\n  options: string[];\n  question: string;\n  explanation: string;\n  question_number: string;\n  why_incorrect?: string;\n  references?: string;\n};\ntype Topic = { questions: Question[]; case_study?: string; topic_name?: string; };\ntype SimulationData = { fileName: string; topics: Record<string, Topic>; };\ntype SupabaseFile = { 'ai-parsed-data': { result: { topics: Record<string, Topic>; }; }; filename: string; };\ntype StructuredItem = { type: 'question'; content: Question; parent?: { topic?: string | undefined; caseStudyTitle?: string | undefined; caseStudyDescription?: string | undefined; caseStudyQuestionsCount?: number | undefined; } };\n// --- SVG Icons ---\nconst IconSearch = () => <svg width=\"20\" height=\"20\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159L11.5 12.5L12.5 11.5L10.0158 9.30885C9.42248 9.75587 8.68594 10.0345 7.89932 10.0883L6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5C10 7.50556 9.61334 8.42373 9.00001 9.13098L9.30884 10.0159Z\" fill=\"#757575\"></path></svg>;\nconst IconDownload = () => <svg width=\"18\" height=\"18\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M4 6H2V12.5C2 12.7761 2.22386 13 2.5 13H12.5C12.7761 13 13 12.7761 13 12.5V6H11V12H4V6ZM7.5 10L11 5H8V2H7V5H4L7.5 10Z\" fill=\"currentColor\"></path></svg>;\nconst IconEye = () => <svg width=\"16\" height=\"16\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7.5 11C4.79322 11 2.49241 9.2993 1.05532 7.50001C2.49241 5.70072 4.79322 4 7.5 4C10.2068 4 12.5076 5.70072 13.9447 7.50001C12.5076 9.2993 10.2068 11 7.5 11ZM7.5 3C4.33776 3 1.68988 5.00373 0.160645 6.88398L0.116041 6.94165C-0.0386803 7.14378 -0.0386803 7.85624 0.116041 8.05837L0.160645 8.11604C1.68988 9.99629 4.33776 12 7.5 12C10.6622 12 13.3101 9.99629 14.8394 8.11604L14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398C13.3101 5.00373 10.6622 3 7.5 3ZM7.5 9C6.40237 9 5.50655 8.11289 5.5 7.00001C5.50655 5.88713 6.40237 5.00001 7.5 5.00001C8.59763 5.00001 9.49345 5.88713 9.5 7.00001C9.49345 8.11289 8.59763 9 7.5 9Z\" fill=\"currentColor\"></path></svg>;\nconst IconEyeSlash = () => <svg width=\"16\" height=\"16\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1.3415 13.6585L13.6582 1.34176L12.9511 0.634691L0.634433 12.9514L1.3415 13.6585ZM4.39893 9.60107C3.13626 8.87784 2.15372 7.84628 1.05532 7.5C2.49241 5.70072 4.79322 4 7.5 4C8.61439 4 9.66427 4.29891 10.584 4.80878L9.49989 6.00001C9.49561 5.92548 9.24345 5.88713 9.5 7C9.49345 8.11289 8.59763 9 7.5 9C6.81406 9 6.20237 8.68594 5.86902 8.13098L4.39893 9.60107ZM14.8394 6.88398C13.5936 5.25338 11.6622 3 7.5 3C6.59763 3 5.75655 3.20237 5.00001 3.55837L6.50001 5C6.40237 5 5.50655 5.88713 5.5 7C5.50655 7.24345 5.57452 7.46548 5.68988 7.68988L7.584 9.584C8.75655 9.42548 9.49345 8.49345 9.5 7.41594L13.8839 12.8394C14.4934 12.1129 14.8394 11.2434 14.8394 10.5C14.8394 9.99629 13.3101 8.11604 14.884 8.05837C15.0387 7.85624 15.0387 7.14378 14.884 6.94165L14.8394 6.88398Z\" fill=\"currentColor\"></path></svg>;\nconst IconTopicFolder = ({ style = {} }: { style?: CSSProperties }) => <svg style={style} width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M3 5C3 4.44772 3.44772 4 4 4H9.17157C9.58052 4 9.91096 4.24065 10.0607 4.58579L10.5858 5.75736C10.7355 6.1025 11.0659 6.34315 11.4749 6.34315H20C20.5523 6.34315 21 6.79086 21 7.34315V18C21 18.5523 20.5523 19 20 19H4C3.44772 19 3 18.5523 3 18V5Z\" fill=\"#000000\" fillOpacity=\"0.7\" /></svg>;\nconst IconCaseStudy = () => <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M4 4H20V20H4V4ZM3 3V21H21V3H3ZM6 6H18V8H6V6ZM6 10H18V12H6V10ZM6 14H14V16H6V14Z\" fill=\"#673AB7\"></path></svg>;\nconst IconArrowBack = ({ style = {} }: { style?: CSSProperties }) => <svg style={style} width=\"20\" height=\"20\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M6.85355 3.14645C7.04882 3.34171 7.04882 3.65829 6.85355 3.85355L3.70711 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H3.70711L6.85355 11.1464C7.04882 11.3417 7.04882 11.6583 6.85355 11.8536C6.65829 12.0488 6.34171 12.0488 6.14645 11.8536L1.64645 7.35355C1.45118 7.15829 1.45118 6.84171 1.64645 6.64645L6.14645 2.14645C6.34171 1.95118 6.65829 1.95118 6.85355 2.14645Z\" fill=\"currentColor\" /></svg>;\nconst IconArrowForward = ({ style = {} }: { style?: CSSProperties }) => <svg style={style} width=\"20\" height=\"20\" viewBox=\"0 0 15 15\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M8.14645 3.14645C8.34171 3.34171 8.34171 3.65829 8.14645 3.85355L4.99999 7H12.5C12.7761 7 13 7.22386 13 7.5C13 7.77614 12.7761 8 12.5 8H5L8.14645 11.1464C8.34171 11.3417 8.34171 11.6583 8.14645 11.8536C7.95118 12.0488 7.6346 12.0488 7.43934 11.8536L2.93934 7.35355C2.74408 7.15829 2.74408 6.84171 2.93934 6.64645L7.43934 2.14645C7.6346 1.95118 7.95118 1.95118 8.14645 2.14645Z\" fill=\"currentColor\" transform=\"scale(-1,1) translate(-15,0)\" /></svg>;\n\n// --- Helper function ---\nconst flattenItems = (topics: Record<string, Topic>): { type: string; content: any }[] => {\n  const flatList: { type: string; content: any }[] = [];\n  Object.entries(topics).forEach(([topicKey, topic]: [string, Topic]) => {\n    if (topic.topic_name) {\n      flatList.push({ type: 'topic', content: { title: topic.topic_name, caseStudyCount: topic.case_study ? 1 : 0 } });\n    }\n    if (topic.case_study) {\n      flatList.push({ type: 'case_study', content: { title: topic.topic_name || topicKey, description: topic.case_study, questionsCount: topic.questions?.length || 0 } });\n    }\n    (topic.questions || []).forEach((q: Question, qIndex: number) => {\n      flatList.push({ type: 'question', content: { ...q, question_number: q.question_number || (qIndex + 1).toString() } });\n    });\n  });\n  return flatList;\n};\n\n// --- Styled Components (Full Definitions) ---\nconst PageContainer = styled.div` display: flex; flex-direction: column; gap: 16px; `;\nconst HeaderContainer = styled.div`\n  @media (min-width: 651px) { display: flex; flex-direction: row; align-items: center; justify-content: space-between; gap: 16px; }\n  @media (max-width: 650px) { display: flex; flex-direction: column; gap: 16px; }\n`;\nconst FileName = styled.h2` color: #2c2c54; font-weight: bold; font-size: 22px; `;\nconst HeaderActions = styled.div` display: flex; align-items: center; gap: 12px; `;\n\nconst DownloadButtonText = styled.span`\n  display: inline;\n  @media (max-width: 650px) {\n    display: none;\n  }\n`;\n\nconst ViewToggle = styled.div`\n  display: flex; align-items: center; gap: 4px; padding: 4px 8px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px;\n  span { font-weight: bold; color: #757575; }\n  svg { color: #757575; }\n`;\nconst Switch = styled.input.attrs({ type: 'checkbox' })`\n  appearance: none; width: 34px; height: 20px; background: #E0E0E0; border-radius: 10px; position: relative; cursor: pointer;\n  &:checked { background: #673AB7; }\n  &::before { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background: white; border-radius: 50%; transition: 0.2s; }\n  &:checked::before { left: 16px; }\n`;\nconst GoToButton = styled.button`\n  background: none; border: 1px solid #E0E0E0; padding: 8px 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; color: #757575;\n`;\nconst DownloadButton = styled.button`\n  background-color: #673AB7; color: white; border: none; border-radius: 12px; padding: 10px 16px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px;\n @media (max-width: 650px) {\n    padding: 12px;\n    border-radius: 50%;\n  }\n`;\nconst GoToFieldContainer = styled.div<{ $show: boolean }>`\n  height: ${({ $show }) => $show ? '60px' : '0'}; display: flex; justify-content: center; align-items: center; gap: 8px; overflow: hidden; transition: height 0.3s;\n`;\nconst GoToInput = styled.input` width: 150px; text-align: center; border: 1px solid #E0E0E0; border-radius: 8px; padding: 8px; `;\nconst GoButton = styled.button` background-color: #673AB7; color: white; border: none; padding: 8px 16px; border-radius: 8px; `;\nconst ContentContainer = styled.div` background-color: white; border-radius: 12px; border: 1px solid #E0E0E0; `;\nconst TopicHeader = styled.div` padding: 24px 16px 16px; display: flex; align-items: center; gap: 16px; font-size: 20px; font-weight: bold; color: #424242; span { font-weight: 500; } `;\nconst CaseStudyContainer = styled.div` background-color: rgba(239, 234, 254, 0.4); border-bottom: 1px solid rgba(103, 58, 183, 0.2); padding: 26px; `;\nconst CaseStudyHeader = styled.div` display: flex; align-items: center; gap: 12px; font-size: 18px; font-weight: bold; color: #673AB7; @media (max-width: 500px) { flex-direction: column; align-items: flex-start; } `;\nconst CaseStudyLabel = styled.p` color: #BDBDBD; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; `;\nconst CaseStudyQuestions = styled.span` font-size: 14px; font-weight: 500; color: #757575; `;\nconst CaseStudyToggle = styled.button` background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;\nconst CaseStudyContent = styled.div<{ $expanded: boolean }>`\n  max-height: ${({ $expanded }) => $expanded ? 'none' : '50px'}; overflow: hidden; transition: max-height 0.3s; \n`;\nconst HideButtonBottom = styled.button` position: absolute; bottom: 10px; right: 10px; background: none; border: none; color: #673AB7; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer; `;\nconst QuestionCardContainer = styled.div` padding: 26px; `;\nconst QuestionHeader = styled.div` @media (min-width: 601px) { display: flex; align-items: flex-start; gap: 18px; } @media (max-width: 600px) { display: flex; flex-direction: column; gap: 16px; } `;\nconst QuestionNumber = styled.div` background-color: rgba(103, 58, 183, 0.12); color: #673AB7; font-weight: bold; font-size: 16px; padding: 12px; border-radius: 10px; `;\nconst Label = styled.p` color:rgb(131, 129, 131); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; margin-top: 20px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `; const OptionsList = styled.div` display: flex; flex-direction: column; gap: 11px; @media (min-width: 601px) { padding-left: 1px; } @media (max-width: 600px) { padding-left: 0; } `;\n// This is the only change you need\n\nconst OptionItem = styled.div<{ $isCorrect: boolean }>`\n  display: flex;\n align-items: baseline;\n  gap: 8px;\n  border: 1px solid ${({ $isCorrect }) => $isCorrect ? '#38b000' : '#E0E0E0'};\n  background: ${({ $isCorrect }) => $isCorrect ? '#F4FBF6' : 'transparent'};\n  border-radius: 8px;\n  padding: 11px 14px;\n  font-size: 15px;\n  line-height: 1.35;\n  transition: all 0.14s;\n  box-shadow: ${({ $isCorrect }) => $isCorrect ? '0 2px 6px rgba(56,176,0,0.1)' : 'none'};\n`;\nconst ActionButtons = styled.div` display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 8px; margin-top: 26px; `;\nconst PrimaryButton = styled.button` border: none; background-color: #673AB7; color: white; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 500; `;\nconst CorrectAnswerSection = styled.div` display: flex; align-items: center; gap: 8px; padding: 12px 0; @media (max-width: 600px) { flex-direction: column; align-items: flex-start; gap: 16px; } `;\nconst CorrectLabel = styled.span`\n  display: block; /* ✅ Stacks the elements vertically */\n  color:rgb(0, 0, 0);\n  font-weight: 600;\n  font-size: 13px;\n  margin-bottom: 5px;\n`;\n\nconst CorrectText = styled.span`\n  font-weight: regular;\n  font-size: 15px;\n`;\nconst ExplanationSection = styled.div` margin-top: 8px; `;\nconst PaginationContainer = styled.div` display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background-color: white; border: 1px solid #E0E0E0; border-radius: 12px; `;\nconst PageButton = styled.button` background: none; border: 1px solid #E0E0E0; color: #333; padding: 8px 16px; border-radius: 8px; cursor: pointer; &:disabled { cursor: not-allowed; opacity: 0.5; } `;\nconst LoadingContainer = styled.div` display: flex; justify-content: center; align-items: center; height: 300px; font-size: 18px; color: #757575;`;\nconst PaginationText = styled.span` color: #757575; font-weight: 500; `;\n\n// --- The Main Page Component ---\n\n// STATE HOOKS\n\nconst SimulationPage = () => {\n  const { fileId } = useParams<{ fileId: string }>();\n  const [simulationData, setSimulationData] = useState<SimulationData | null>(null);\n  const [structuredItems, setStructuredItems] = useState<StructuredItem[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [isLoading, setLoading] = useState(true);\n  const [showAnswer, setShowAnswer] = useState(false);\n  const [isSingleView, setIsSingleView] = useState(true);\n  const [showGoToField, setShowGoToField] = useState(false);\n  const [goToInput, setGoToInput] = useState('');\n  const [showAnswersMap, setShowAnswersMap] = useState<Record<string, boolean>>({});\n  const { user } = useUser();\n  const location = useLocation();\n  const [multiViewPage, setMultiViewPage] = useState(1);\n  const startIndex = location.state?.startIndex;\n  const [debouncedIndex] = useDebounce(currentIndex, 1500); // Saves 1.5s after user stops\n  const [alertInfo, setAlertInfo] = useState({ isOpen: false, message: \"\", href: null as string | null });\n  const [downloadUrl, setDownloadUrl] = useState<string | null>(null);\n\n\n  const handleReferenceLinkClick = (href: string) => {\n    setAlertInfo({\n      isOpen: true,\n      href: href, // Store the link to open\n      message: \"You are accessing a reference link. Before you move out, please remember that platforms keep changing their URLs for such documents, and by the time you click it, it might have changed. In case the link is broken or returns a \\\"Not Found,\\\" error, the best way is to search the reference doc online. Thank you.\"\n    });\n  };\n\n  const handleAlertConfirm = () => {\n    // This function runs when \"OK\" is clicked.\n    if (alertInfo.href) {\n      // This method is more likely to open a new tab instead of a new window.\n      const link = document.createElement('a');\n      link.href = alertInfo.href;\n      link.target = '_blank';\n      link.rel = 'noopener noreferrer';\n      link.click();\n    }\n    // Close the modal\n    setAlertInfo({ isOpen: false, message: \"\", href: null });\n  };\n\n  useEffect(() => {\n    if (!fileId) return;\n    async function getSimulationData() {\n      setLoading(true);\n      const { data, error } = await supabase.from('files').select('filename, ai-parsed-data').eq('id', fileId).single<SupabaseFile>();\n      if (error) {\n        console.error(\"Error fetching file:\", error);\n      } else if (data && data['ai-parsed-data']?.result?.topics) {\n        const topics = data['ai-parsed-data'].result.topics;\n        setSimulationData({ fileName: data.filename, topics: topics });\n        const newStructuredItems: StructuredItem[] = [];\n        let globalQNum = 1;\n        Object.values(topics).forEach((topic: Topic) => {\n          (topic.questions || []).forEach((q: Question) => {\n            newStructuredItems.push({\n              type: 'question',\n              content: { ...q, question_number: (globalQNum++).toString() },\n              parent: { topic: topic.topic_name, caseStudyTitle: topic.case_study ? topic.topic_name : undefined, caseStudyDescription: topic.case_study ? topic.case_study : undefined, caseStudyQuestionsCount: topic.case_study ? (topic.questions?.length || 0) : 0 }\n            });\n          });\n        });\n        setStructuredItems(newStructuredItems);\n        if (startIndex && startIndex > 0 && startIndex < newStructuredItems.length) {\n          setCurrentIndex(startIndex);\n        }\n      }\n\n      setLoading(false);\n    }\n    getSimulationData();\n  }, [fileId, startIndex]);\n\n  useEffect(() => {\n    setShowAnswer(false);\n  }, [currentIndex]);\n\n  // --- This entire block is new ---\n  useEffect(() => {\n    const saveProgress = async () => {\n      // Use the user object directly from your context\n      if (!user || !fileId || !simulationData || structuredItems.length === 0) {\n        return;\n      }\n\n      const { error } = await supabase.from('user_progress').upsert({\n        // This now sends the correct numeric WordPress ID\n        user_id: user.id,\n        last_viewed_file_id: fileId,\n        product_name: simulationData.fileName,\n        last_viewed_question_index: debouncedIndex,\n        total_questions: structuredItems.length,\n        updated_at: new Date().toISOString(),\n      });\n\n      if (error) {\n        console.error(\"Supabase error saving progress:\", error);\n      }\n    };\n\n    // Only save if the user has actually navigated to a question\n    saveProgress();\n\n  }, [debouncedIndex, user, fileId, simulationData, structuredItems.length]); // Dependencies\n\n\n  useEffect(() => {\n    if (!user || !fileId) return;\n\n    const getDownloadLink = async () => {\n      try {\n        const { data: apiResponse, error } = await supabase.functions.invoke('get-wc-data', {\n          body: {\n            method: 'GET',\n            endpoint: 'cwc/downloads',\n            user_id: user.id\n          },\n        });\n\n        if (error) throw error;\n\n        if (apiResponse && apiResponse.Success && Array.isArray(apiResponse.Data)) {\n          // Find the download that corresponds to the current simulation file\n          const matchingDownload = apiResponse.Data.find(d => d.supabase_file_id === fileId);\n          if (matchingDownload) {\n            setDownloadUrl(matchingDownload.download_url);\n          }\n        }\n      } catch (err) {\n        console.error(\"Error fetching download link for simulation:\", err);\n      }\n    };\n\n    getDownloadLink();\n  }, [user, fileId]); // Dependencies\n\n\n  useEffect(() => {\n    setCurrentIndex(0);\n    setShowAnswersMap({});\n    setShowAnswer(false);\n    setMultiViewPage(1);\n  }, [isSingleView]);\n\n  const handleNext = () => setCurrentIndex(prev => Math.min(prev + 1, structuredItems.length - 1));\n  const handlePrev = () => setCurrentIndex(prev => Math.max(prev - 1, 0));\n\n  const currentItem = structuredItems[currentIndex];\n\n  if (isLoading) return <LoadingContainer>Loading Simulation...</LoadingContainer>;\n  if (!currentItem) return <LoadingContainer>Could not load questions for this file.</LoadingContainer>;\n\n  // ✅ CALCULATE PAGINATION FOR MULTI-VIEW\n  const itemsPerPage = 25;\n  const allMultiViewItems = flattenItems(simulationData?.topics || {});\n  const totalMultiViewPages = Math.ceil(allMultiViewItems.length / itemsPerPage);\n  // Get the 25 items for the current page\n  const paginatedMultiViewItems = allMultiViewItems.slice(\n    (multiViewPage - 1) * itemsPerPage,\n    multiViewPage * itemsPerPage\n  );\n\n  return (\n    <PageContainer>\n      <HeaderContainer>\n        <FileName title={simulationData?.fileName}>{simulationData?.fileName}</FileName>\n        <HeaderActions>\n          <ViewToggle>\n            <span>View:</span>\n            <IconTopicFolder style={{ color: !isSingleView ? '#673AB7' : '#757575', width: 20, height: 20 }} />\n            <Switch checked={isSingleView} onChange={(e) => setIsSingleView(e.target.checked)} />\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" style={{ color: isSingleView ? '#673AB7' : '#757575' }}><path d=\"M4 6H20V8H4V6ZM4 11H20V13H4V11ZM4 16H20V18H4V16Z\" fill=\"currentColor\" /></svg>\n          </ViewToggle>\n          <GoToButton onClick={() => setShowGoToField(!showGoToField)}>\n            <IconSearch /> Go To\n          </GoToButton>\n          <DownloadButton\n            onClick={() => window.open(downloadUrl, '_blank')}\n            disabled={!downloadUrl}\n            title={!downloadUrl ? \"Download link not available\" : \"Download file\"}\n          >\n            <IconDownload />\n            <DownloadButtonText>Download</DownloadButtonText>\n          </DownloadButton>\n        </HeaderActions>\n      </HeaderContainer>\n\n      <GoToFieldContainer $show={showGoToField}>\n        <GoToInput type=\"number\" value={goToInput} onChange={(e) => setGoToInput(e.target.value)} placeholder=\"Go to...\" />\n        <GoButton onClick={() => {\n          const target = parseInt(goToInput);\n          if (target >= 1 && target <= structuredItems.length) {\n            setCurrentIndex(target - 1);\n            setIsSingleView(true);\n            setShowGoToField(false);\n            setGoToInput('');\n          } else {\n            alert(`Enter a number between 1 and ${structuredItems.length}`);\n          }\n        }}>Go</GoButton>\n      </GoToFieldContainer>\n\n      <ContentContainer>\n        {isSingleView ? (\n          // --- Single View (no changes here) ---\n          <>\n            {currentItem.parent?.topic && (\n              <TopicHeader>\n                <IconTopicFolder />\n                <div>\n                  <span>Topic: </span>{currentItem.parent.topic}\n                  {currentItem.parent?.caseStudyDescription && <div style={{ fontSize: 14, color: '#757575' }}>Case Studies: 1</div>}\n                </div>\n              </TopicHeader>\n            )}\n            {currentItem.parent?.caseStudyTitle && <RenderCaseStudy caseStudy={{ title: currentItem.parent.caseStudyTitle || 'Case Study', description: currentItem.parent.caseStudyDescription || '', questionsCount: currentItem.parent.caseStudyQuestionsCount ?? 0 }} />}\n            <RenderQuestion\n              question={currentItem.content}\n              showAnswer={showAnswer}\n              setShowAnswer={setShowAnswer}\n              onLinkClick={handleReferenceLinkClick}\n            />\n          </>\n        ) : (\n          // --- ✅ MODIFIED MULTI-VIEW WITH PAGINATION ---\n          <>\n            {/* Map over the paginated list, not the full list */}\n            {paginatedMultiViewItems.map((item, index) => (\n              <div key={index}>\n                {item.type === 'topic' && (\n                  <TopicHeader>\n                    <IconTopicFolder />\n                    <div>\n                      <span>Topic: </span>{item.content.title}\n                      {item.content.caseStudyCount > 0 && <div style={{ fontSize: 14, color: '#757575' }}>Case Studies: {item.content.caseStudyCount}</div>}\n                    </div>\n                  </TopicHeader>\n                )}\n                {item.type === 'case_study' && <RenderCaseStudy caseStudy={item.content} />}\n                {item.type === 'question' && (\n                  <RenderQuestion\n                    question={item.content}\n                    showAnswer={showAnswersMap[item.content.question_number] || false}\n                    setShowAnswer={(newVal: boolean) => setShowAnswersMap(prev => ({ ...prev, [item.content.question_number]: newVal }))}\n                    onLinkClick={handleReferenceLinkClick}\n                  />\n                )}\n              </div>\n            ))}\n            {/* Pagination controls for multi-view */}\n            {totalMultiViewPages > 1 && (\n              <PaginationContainer>\n                <PaginationText>Page {multiViewPage} of {totalMultiViewPages}</PaginationText>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  <PageButton onClick={() => setMultiViewPage(p => Math.max(1, p - 1))} disabled={multiViewPage === 1}>\n                    <IconArrowBack />\n                  </PageButton>\n                  <PageButton onClick={() => setMultiViewPage(p => Math.min(totalMultiViewPages, p + 1))} disabled={multiViewPage === totalMultiViewPages}>\n                    <IconArrowForward />\n                  </PageButton>\n                </div>\n              </PaginationContainer>\n            )}\n          </>\n        )}\n      </ContentContainer>\n\n      <PaginationContainer>\n        <PaginationText>Question {isSingleView ? currentItem.content.question_number : 'Page View'} of {structuredItems.length}</PaginationText>\n        <div style={{ display: 'flex', gap: '8px' }}>\n          <PageButton onClick={handlePrev} disabled={currentIndex === 0} style={{ color: currentIndex === 0 ? '#757575' : '#673AB7' }}><IconArrowBack /></PageButton>\n          <PageButton onClick={handleNext} disabled={currentIndex === structuredItems.length - 1} style={{ color: currentIndex === structuredItems.length - 1 ? '#757575' : '#673AB7' }}><IconArrowForward /></PageButton>\n        </div>\n      </PaginationContainer>\n      <AlertModal\n        isOpen={alertInfo.isOpen}\n        message={alertInfo.message}\n        onConfirm={handleAlertConfirm}\n      />\n    </PageContainer>\n  );\n};\n\nconst RenderCaseStudy = ({ caseStudy }: { caseStudy: { title: string; description: string; questionsCount: number } }) => {\n  const [expanded, setExpanded] = useState(false);\n  return (\n    <CaseStudyContainer>\n      <CaseStudyHeader>\n        <IconCaseStudy />\n        <div style={{ flex: 1 }}>\n          <CaseStudyLabel>Case Study</CaseStudyLabel>\n          {caseStudy.title}\n        </div>\n        <CaseStudyQuestions>Questions: {caseStudy.questionsCount}</CaseStudyQuestions>\n        <CaseStudyToggle onClick={() => setExpanded(!expanded)}>\n          {expanded ? 'Hide' : 'Show'} {expanded ? <IconArrowBack style={{ transform: 'rotate(90deg)' }} /> : <IconArrowForward style={{ transform: 'rotate(90deg)' }} />}\n        </CaseStudyToggle>\n      </CaseStudyHeader>\n      <div style={{ position: 'relative' }}>\n        <CaseStudyContent $expanded={expanded}>\n          <HtmlRenderer htmlString={caseStudy.description} />\n        </CaseStudyContent>\n        {expanded && (\n          <HideButtonBottom onClick={() => setExpanded(false)}>\n            Hide <IconArrowBack style={{ transform: 'rotate(90deg)' }} />\n          </HideButtonBottom>\n        )}\n      </div>\n    </CaseStudyContainer>\n  );\n};\n\n\nconst AlertModal = ({\n  isOpen,\n  message,\n  onConfirm, // 👈 Change onClose to onConfirm\n}: {\n  isOpen: boolean;\n  message: string;\n  onConfirm: () => void; // 👈 Change the prop name and type\n}) => {\n  if (!isOpen) return null;\n\n  const modalStyle: React.CSSProperties = {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: 'rgba(0, 0, 0, 0.6)',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    zIndex: 1000,\n  };\n\n  const contentStyle: React.CSSProperties = {\n    backgroundColor: 'white',\n    padding: '30px',\n    borderRadius: '12px',\n    maxWidth: '500px',\n    boxShadow: '0 5px 15px rgba(0,0,0,0.3)',\n    textAlign: 'center',\n    lineHeight: 1.6\n  };\n\n  return (\n    <div style={modalStyle} onClick={onConfirm}> {/* Close on background click */}\n      <div style={contentStyle} onClick={(e) => e.stopPropagation()}>\n        <p>{message}</p>\n        <button\n          onClick={onConfirm} // 👈 Use onConfirm here\n          style={{\n            marginTop: '20px',\n            padding: '10px 24px',\n            border: 'none',\n            backgroundColor: '#673AB7',\n            color: 'white',\n            borderRadius: '8px',\n            cursor: 'pointer',\n            fontWeight: 600\n          }}\n        >\n          OK\n        </button>\n      </div>\n    </div>\n  );\n};\n\n\nconst RenderQuestion = ({\n  question,\n  showAnswer,\n  setShowAnswer,\n  onLinkClick,\n}: {\n  question: any; // Accept \"any\" for robust fallback\n  showAnswer: boolean;\n  setShowAnswer: (val: boolean) => void;\n  onLinkClick: (href: string) => void;\n}) => {\n\n  const handleLinkClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    const target = e.target as HTMLElement;\n    if (target.tagName === 'A') {\n      e.preventDefault(); // Still prevent the default to call our custom handler\n      const href = target.getAttribute('href');\n      if (href) {\n        onLinkClick(href); // 👈 Use the prop to call the function in the parent\n      }\n    }\n  };\n\n  // Defensive extraction with fallback\n  const answerArray = Array.isArray(question.answer)\n    ? question.answer\n    : typeof question.answer === \"string\" && question.answer.length\n      ? [question.answer]\n      : [];\n  const optionsArray = Array.isArray(question.options)\n    ? question.options\n    : typeof question.options === \"string\" && question.options.length\n      ? [question.options]\n      : [];\n\n  // Correct answer display string\n  const correctLetters = answerArray.join(\", \");\n\n  // Extra fields (handle snake_case and camelCase)\n  const explanation =\n    typeof question.explanation === \"string\"\n      ? question.explanation\n      : \"\";\n  const whyIncorrect =\n    typeof question.why_incorrect === \"string\"\n      ? question.why_incorrect\n      : typeof question.whyIncorrect === \"string\"\n        ? question.whyIncorrect\n        : \"\";\n  // References may be array or string\n  let references = question.references ?? question.References ?? \"\";\n  if (Array.isArray(references)) references = references.join(\"\\n\");\n  references = typeof references === \"string\" ? references : \"\";\n\n  // \"Has\" checkers\n  const hasExplanation = explanation.trim() !== \"\";\n  const hasWhyIncorrect = whyIncorrect.trim() !== \"\";\n  const hasReferences = references.trim() !== \"\";\n\n\n  return (\n    <QuestionCardContainer\n      style={{\n        background: showAnswer\n          ? \"linear-gradient(to bottom, rgba(239,234,254,0.15) 60%, white)\"\n          : \"white\",\n        borderRadius: 18,\n        boxShadow: \"0 5px 15px rgba(103,58,183,0.04)\",\n        marginBottom: 24,\n      }}\n    >\n      <QuestionHeader>\n        <QuestionNumber>Q: {question.question_number || question.id || \"\"}</QuestionNumber>\n        <div style={{ flex: 1 }}>\n          <HtmlRenderer htmlString={typeof question.question === \"string\" ? question.question : \"\"} />\n        </div>\n      </QuestionHeader>\n\n      {optionsArray.length > 0 && <Label>Options</Label>}\n      <OptionsList>\n        {optionsArray.map((opt: string, index: number) => {\n          const letter = String.fromCharCode(65 + index);\n          // Prepare all possible representations of the answer\n          const answerSet = new Set(\n            answerArray\n              .flatMap((a: string) => a.split(/,\\s*/)) // Splits \"A, C\" into [\"A\", \"C\"]\n              .map((a: string) => a.trim().toUpperCase())\n          );          // Compare by letter (\"A\", \"B\", etc)\n          const letterIsCorrect = answerSet.has(letter.toUpperCase());\n          // Compare by text (full option value, stripped and uppercased)\n          const valueIsCorrect =\n            answerSet.has(opt.trim().toUpperCase()) ||\n            answerSet.has(opt.trim());\n          // Highlight if either matches\n          const isCorrect = showAnswer && (letterIsCorrect || valueIsCorrect);\n\n          return (\n            <OptionItem key={index} $isCorrect={isCorrect}>\n              <b>{letter}: </b>\n              <span style={{ display: \"inline\" }}>\n                <HtmlRenderer htmlString={typeof opt === \"string\" ? opt.replace(/^[A-Z][.)]\\s*/, \"\") : \"\"} />\n              </span>\n            </OptionItem>\n          );\n        })}\n      </OptionsList>\n\n      <ActionButtons>\n        <PrimaryButton onClick={() => setShowAnswer(!showAnswer)}>\n          <>\n            {showAnswer ? <IconEyeSlash /> : <IconEye />}{\" \"}\n            {showAnswer ? \"Hide Answer\" : \"Show Answer\"}\n          </>\n        </PrimaryButton>\n      </ActionButtons>\n\n      {showAnswer && (\n        <>\n          <div style={{ borderTop: \"1.1px solid #E0E0E0\", margin: \"32px 0\" }} />\n          <CorrectAnswerSection>\n            <div>\n              <CorrectLabel>Correct Answer:</CorrectLabel>{\" \"}\n              <CorrectText>{correctLetters}</CorrectText>\n            </div>\n            {/*         <ReportButton\n              style={{ marginLeft: \"auto\" }}\n              onClick={() => alert(\"Report answer submitted\")}\n            >\n              <IconWarning /> Report Answer as Incorrect\n            </ReportButton>\n\n                                              */}\n\n          </CorrectAnswerSection>\n\n          {hasExplanation && (\n            <ExplanationSection>\n              <Label>Explanation</Label>\n              <HtmlRenderer htmlString={explanation} />\n              <div style={{ textAlign: \"right\", marginTop: 10 }}>\n\n              </div>\n            </ExplanationSection>\n          )}\n\n          {hasWhyIncorrect && (\n            <ExplanationSection>\n              <Label>Why Incorrect Options are Wrong</Label>\n              <HtmlRenderer htmlString={formatParagraphs(whyIncorrect)} />\n            </ExplanationSection>\n          )}\n\n          {hasReferences && (\n            // 👇 And attach handler here\n            <ExplanationSection onClick={handleLinkClick}>\n              <Label>References</Label>\n              <HtmlRenderer htmlString={formatParagraphs(references)} />\n            </ExplanationSection>\n          )}\n        </>\n      )}\n    </QuestionCardContainer>\n  );\n};\n\n\n\n\nexport default SimulationPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}