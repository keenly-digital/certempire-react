{"ast":null,"code":"var _jsxFileName = \"/Users/megamac/Dev/GitHub/projects/certempire-react/src/App.tsx\",\n  _s = $RefreshSig$();\n// src/App.tsx\nimport React, { useEffect } from 'react';\nimport { ThemeProvider } from 'styled-components';\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport { UserProvider, useUser } from './context/UserContext';\nimport { supabase } from './supabaseClient'; // Import the main supabase client\n\nimport { GlobalStyle } from './styles/GlobalStyle';\nimport { theme } from './styles/theme';\nimport MainLayout from './components/common/MainLayout';\nimport DashboardPage from './pages/DashboardPage';\nimport OrdersPage from './pages/OrdersPage';\nimport OrderDetailPage from './pages/OrderDetailPage';\nimport DownloadsPage from './pages/DownloadsPage';\nimport AddressesPage from './pages/AddressesPage';\nimport AccountDetailsPage from './pages/AccountDetailsPage';\nimport SimulationPage from './pages/SimulationPage';\n\n// This is the new component that handles the token logic AND sets the Supabase session\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AppInitializer = () => {\n  _s();\n  const {\n    setUser\n  } = useUser();\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const token = urlParams.get('auth_token');\n    if (token) {\n      try {\n        const decodedUserData = JSON.parse(atob(token));\n\n        // This is the critical new part: We tell Supabase who the user is.\n        // We are creating a \"fake\" session using the data from WordPress.\n        supabase.auth.setSession({\n          access_token: token,\n          // We can use the token itself as the access token\n          user: {\n            id: decodedUserData.simulation_user_id,\n            email: decodedUserData.email,\n            aud: 'authenticated',\n            role: 'authenticated',\n            created_at: new Date().toISOString(),\n            app_metadata: {},\n            user_metadata: {\n              name: decodedUserData.name\n            }\n          }\n        });\n\n        // Now we save the user to our context as before\n        setUser(decodedUserData);\n        window.history.replaceState({}, document.title, window.location.pathname);\n      } catch (e) {\n        console.error(\"Failed to decode or set session from auth token:\", e);\n      }\n    }\n  }, [setUser]);\n  return null;\n};\n_s(AppInitializer, \"BBIL3FZ06163hbrZEWWyKR/9xXs=\", false, function () {\n  return [useUser];\n});\n_c = AppInitializer;\nfunction App() {\n  return /*#__PURE__*/_jsxDEV(UserProvider, {\n    children: /*#__PURE__*/_jsxDEV(ThemeProvider, {\n      theme: theme,\n      children: [/*#__PURE__*/_jsxDEV(GlobalStyle, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Router, {\n        children: [/*#__PURE__*/_jsxDEV(AppInitializer, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(MainLayout, {\n          children: /*#__PURE__*/_jsxDEV(Routes, {\n            children: [/*#__PURE__*/_jsxDEV(Route, {\n              path: \"/\",\n              element: /*#__PURE__*/_jsxDEV(DashboardPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 71,\n                columnNumber: 40\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 71,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/orders\",\n              element: /*#__PURE__*/_jsxDEV(OrdersPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 72,\n                columnNumber: 46\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 72,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/orders/:orderId\",\n              element: /*#__PURE__*/_jsxDEV(OrderDetailPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 73,\n                columnNumber: 55\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 73,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/downloads\",\n              element: /*#__PURE__*/_jsxDEV(DownloadsPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 74,\n                columnNumber: 49\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/addresses\",\n              element: /*#__PURE__*/_jsxDEV(AddressesPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 75,\n                columnNumber: 49\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 75,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/account-details\",\n              element: /*#__PURE__*/_jsxDEV(AccountDetailsPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 76,\n                columnNumber: 55\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 76,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Route, {\n              path: \"/practice/:fileId\",\n              element: /*#__PURE__*/_jsxDEV(SimulationPage, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 77,\n                columnNumber: 56\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 77,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n_c2 = App;\nexport default App;\nvar _c, _c2;\n$RefreshReg$(_c, \"AppInitializer\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"names":["React","useEffect","ThemeProvider","BrowserRouter","Router","Routes","Route","UserProvider","useUser","supabase","GlobalStyle","theme","MainLayout","DashboardPage","OrdersPage","OrderDetailPage","DownloadsPage","AddressesPage","AccountDetailsPage","SimulationPage","jsxDEV","_jsxDEV","AppInitializer","_s","setUser","urlParams","URLSearchParams","window","location","search","token","get","decodedUserData","JSON","parse","atob","auth","setSession","access_token","user","id","simulation_user_id","email","aud","role","created_at","Date","toISOString","app_metadata","user_metadata","name","history","replaceState","document","title","pathname","e","console","error","_c","App","children","fileName","_jsxFileName","lineNumber","columnNumber","path","element","_c2","$RefreshReg$"],"sources":["/Users/megamac/Dev/GitHub/projects/certempire-react/src/App.tsx"],"sourcesContent":["// src/App.tsx\nimport React, { useEffect } from 'react';\nimport { ThemeProvider } from 'styled-components';\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport { UserProvider, useUser } from './context/UserContext';\nimport { supabase } from './supabaseClient'; // Import the main supabase client\n\nimport { GlobalStyle } from './styles/GlobalStyle';\nimport { theme } from './styles/theme';\n\nimport MainLayout from './components/common/MainLayout';\nimport DashboardPage from './pages/DashboardPage';\nimport OrdersPage from './pages/OrdersPage';\nimport OrderDetailPage from './pages/OrderDetailPage';\nimport DownloadsPage from './pages/DownloadsPage';\nimport AddressesPage from './pages/AddressesPage';\nimport AccountDetailsPage from './pages/AccountDetailsPage';\nimport SimulationPage from './pages/SimulationPage';\n\n// This is the new component that handles the token logic AND sets the Supabase session\nconst AppInitializer = () => {\n  const { setUser } = useUser();\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const token = urlParams.get('auth_token');\n\n    if (token) {\n      try {\n        const decodedUserData = JSON.parse(atob(token));\n        \n        // This is the critical new part: We tell Supabase who the user is.\n        // We are creating a \"fake\" session using the data from WordPress.\n        supabase.auth.setSession({\n            access_token: token, // We can use the token itself as the access token\n            user: {\n                id: decodedUserData.simulation_user_id,\n                email: decodedUserData.email,\n                aud: 'authenticated',\n                role: 'authenticated',\n                created_at: new Date().toISOString(),\n                app_metadata: {},\n                user_metadata: {\n                    name: decodedUserData.name\n                }\n            }\n        });\n\n        // Now we save the user to our context as before\n        setUser(decodedUserData);\n        window.history.replaceState({}, document.title, window.location.pathname);\n\n      } catch (e) {\n        console.error(\"Failed to decode or set session from auth token:\", e);\n      }\n    }\n  }, [setUser]);\n\n  return null;\n}\n\nfunction App() {\n  return (\n    <UserProvider>\n      <ThemeProvider theme={theme}>\n        <GlobalStyle />\n        <Router>\n          <AppInitializer />\n          <MainLayout>\n            <Routes>\n              <Route path=\"/\" element={<DashboardPage />} />\n              <Route path=\"/orders\" element={<OrdersPage />} />\n              <Route path=\"/orders/:orderId\" element={<OrderDetailPage />} />\n              <Route path=\"/downloads\" element={<DownloadsPage />} />\n              <Route path=\"/addresses\" element={<AddressesPage />} />\n              <Route path=\"/account-details\" element={<AccountDetailsPage />} />\n              <Route path=\"/practice/:fileId\" element={<SimulationPage />} />\n            </Routes>\n          </MainLayout>\n        </Router>\n      </ThemeProvider>\n    </UserProvider>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}