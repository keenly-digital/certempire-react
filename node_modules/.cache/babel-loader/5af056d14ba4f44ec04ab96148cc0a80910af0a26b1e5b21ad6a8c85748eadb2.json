{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const UserContext=/*#__PURE__*/createContext({user:null,isLoading:true,logout:()=>{}});export const UserProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isLoading,setLoading]=useState(true);useEffect(()=>{// Check for token in URL (from WordPress)\nconst urlParams=new URLSearchParams(window.location.search);const token=urlParams.get('auth_token');if(token){try{const decodedUserData=JSON.parse(atob(token));setUser(decodedUserData);localStorage.setItem('app_user_session',JSON.stringify(decodedUserData));window.history.replaceState({},document.title,window.location.pathname);setLoading(false);return;}catch(e){console.error(\"Failed to decode auth token:\",e);}}// If no token, check localStorage for existing session\nconst storedUser=localStorage.getItem('app_user_session');if(storedUser){setUser(JSON.parse(storedUser));}setLoading(false);},[]);// Logout clears session and reloads the page (or navigate home)\nconst logout=()=>{setUser(null);localStorage.removeItem('app_user_session');window.location.href='/';// Optional: redirect to homepage\n};return/*#__PURE__*/_jsx(UserContext.Provider,{value:{user,isLoading,logout},children:children});};export const useUser=()=>{return useContext(UserContext);};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","jsx","_jsx","UserContext","user","isLoading","logout","UserProvider","_ref","children","setUser","setLoading","urlParams","URLSearchParams","window","location","search","token","get","decodedUserData","JSON","parse","atob","localStorage","setItem","stringify","history","replaceState","document","title","pathname","e","console","error","storedUser","getItem","removeItem","href","Provider","value","useUser"],"sources":["/Users/megamac/Dev/GitHub/projects/certempire-react/src/context/UserContext.tsx"],"sourcesContent":["import React, { createContext, useState, useContext, ReactNode, useEffect } from 'react';\n\ntype User = {\n  id: number;\n  email: string;\n  name: string;\n  simulation_user_id: string;\n};\n\ntype UserContextType = {\n  user: User | null;\n  isLoading: boolean;\n  logout: () => void;\n};\n\nconst UserContext = createContext<UserContextType>({\n  user: null,\n  isLoading: true,\n  logout: () => { },\n});\n\nexport const UserProvider = ({ children }: { children: ReactNode }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Check for token in URL (from WordPress)\n    const urlParams = new URLSearchParams(window.location.search);\n    const token = urlParams.get('auth_token');\n\n    if (token) {\n      try {\n        const decodedUserData = JSON.parse(atob(token));\n        setUser(decodedUserData);\n        localStorage.setItem('app_user_session', JSON.stringify(decodedUserData));\n        window.history.replaceState({}, document.title, window.location.pathname);\n        setLoading(false);\n        return;\n      } catch (e) {\n        console.error(\"Failed to decode auth token:\", e);\n      }\n    }\n\n    // If no token, check localStorage for existing session\n    const storedUser = localStorage.getItem('app_user_session');\n    if (storedUser) {\n      setUser(JSON.parse(storedUser));\n    }\n    setLoading(false);\n  }, []);\n\n  // Logout clears session and reloads the page (or navigate home)\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem('app_user_session');\n    window.location.href = '/'; // Optional: redirect to homepage\n  };\n\n  return (\n    <UserContext.Provider value={{ user, isLoading, logout }}>\n      {children}\n    </UserContext.Provider>\n  );\n};\n\nexport const useUser = () => {\n  return useContext(UserContext);\n};\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,UAAU,CAAaC,SAAS,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAezF,KAAM,CAAAC,WAAW,cAAGN,aAAa,CAAkB,CACjDO,IAAI,CAAE,IAAI,CACVC,SAAS,CAAE,IAAI,CACfC,MAAM,CAAEA,CAAA,GAAM,CAAE,CAClB,CAAC,CAAC,CAEF,MAAO,MAAM,CAAAC,YAAY,CAAGC,IAAA,EAA2C,IAA1C,CAAEC,QAAkC,CAAC,CAAAD,IAAA,CAChE,KAAM,CAACJ,IAAI,CAAEM,OAAO,CAAC,CAAGZ,QAAQ,CAAc,IAAI,CAAC,CACnD,KAAM,CAACO,SAAS,CAAEM,UAAU,CAAC,CAAGb,QAAQ,CAAC,IAAI,CAAC,CAE9CE,SAAS,CAAC,IAAM,CACd;AACA,KAAM,CAAAY,SAAS,CAAG,GAAI,CAAAC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAC7D,KAAM,CAAAC,KAAK,CAAGL,SAAS,CAACM,GAAG,CAAC,YAAY,CAAC,CAEzC,GAAID,KAAK,CAAE,CACT,GAAI,CACF,KAAM,CAAAE,eAAe,CAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACL,KAAK,CAAC,CAAC,CAC/CP,OAAO,CAACS,eAAe,CAAC,CACxBI,YAAY,CAACC,OAAO,CAAC,kBAAkB,CAAEJ,IAAI,CAACK,SAAS,CAACN,eAAe,CAAC,CAAC,CACzEL,MAAM,CAACY,OAAO,CAACC,YAAY,CAAC,CAAC,CAAC,CAAEC,QAAQ,CAACC,KAAK,CAAEf,MAAM,CAACC,QAAQ,CAACe,QAAQ,CAAC,CACzEnB,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAAE,MAAOoB,CAAC,CAAE,CACVC,OAAO,CAACC,KAAK,CAAC,8BAA8B,CAAEF,CAAC,CAAC,CAClD,CACF,CAEA;AACA,KAAM,CAAAG,UAAU,CAAGX,YAAY,CAACY,OAAO,CAAC,kBAAkB,CAAC,CAC3D,GAAID,UAAU,CAAE,CACdxB,OAAO,CAACU,IAAI,CAACC,KAAK,CAACa,UAAU,CAAC,CAAC,CACjC,CACAvB,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAL,MAAM,CAAGA,CAAA,GAAM,CACnBI,OAAO,CAAC,IAAI,CAAC,CACba,YAAY,CAACa,UAAU,CAAC,kBAAkB,CAAC,CAC3CtB,MAAM,CAACC,QAAQ,CAACsB,IAAI,CAAG,GAAG,CAAE;AAC9B,CAAC,CAED,mBACEnC,IAAA,CAACC,WAAW,CAACmC,QAAQ,EAACC,KAAK,CAAE,CAAEnC,IAAI,CAAEC,SAAS,CAAEC,MAAO,CAAE,CAAAG,QAAA,CACtDA,QAAQ,CACW,CAAC,CAE3B,CAAC,CAED,MAAO,MAAM,CAAA+B,OAAO,CAAGA,CAAA,GAAM,CAC3B,MAAO,CAAAzC,UAAU,CAACI,WAAW,CAAC,CAChC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}